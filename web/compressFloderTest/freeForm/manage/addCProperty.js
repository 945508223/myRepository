var v=new Vue({el:"#formCP",data(){return{isUpdate:false,p:{GUID:"",CTRLNAME:"",PNAME:"",PCNAME:"",GROUPNAME:"",SECONDLEVEL:"",PTYPE:"CTRLDEF",MAPPROPERTY:"",DEFAULTVAL:"",PORDER:undefined,EXTINFO:"",EDITOR:"input",LISTCODE:undefined,READONLY:"0",ISSHOW:"1",PARSETYPE:"STRING",PDESCR:undefined,DISABLESCOPE:undefined},ptypes:[{VALUE:"type1",LABEL:"控件"},{VALUE:"type2",LABEL:"用户"},{VALUE:"type3",LABEL:"系统"}],editors:[{VALUE:"",LABEL:"无"},{VALUE:"grid",LABEL:"图表"},{VALUE:"color",LABEL:"颜色"},{VALUE:"js",LABEL:"js编辑器"}],codeList:[{VALUE:"code1",LABEL:"码表1"},{VALUE:"code2",LABEL:"码表2"},{VALUE:"code3",LABEL:"码表3"}],parseList:[{VALUE:"string",LABEL:"字符串"},{VALUE:"number",LABEL:"数字"},{VALUE:"date",LABEL:"日期"}]}},created:function(){this.p.CTRLNAME=YCDCommon.Win.getUrlParam("ctrlname");var e=YCDCommon.Win.getUrlParam("addOrUpdate");this.p.GUID=YCDCommon.Win.getUrlParam("guid");if(e==="update"){this.isUpdate=true}this.initData()},methods:{initData:function(){this.parseList=$DS.selectBySql(null," select t.coden value,t.cname label from dm_form_code t where t.basename='parseTypes' order by t.porder","格式化类型查询异常");if(this.parseList.isError){alert(this.parseList.errMsg);return false}else{this.parseList=this.parseList.result}this.editors=$DS.selectBySql(null," select t.coden value,t.cname label from dm_form_code t where t.basename='editors' order by t.porder","编辑器查询异常");if(this.editors.isError){alert(this.editors.errMsg);return false}else{this.editors=this.editors.result}this.ptypes=$DS.selectBySql(null," select t.coden value,t.cname label from dm_form_code t where t.basename='protypes' order by t.porder","属性类型查询异常");if(this.ptypes.isError){alert(this.ptypes.errMsg);return false}else{this.ptypes=this.ptypes.result}this.codeList=$DS.selectBySql(null," select t.basename value,t.catename label from dm_form_codecate t order by t.corder","码表类别查询异常");if(this.codeList.isError){alert(this.codeList.errMsg);return false}else{this.codeList=this.codeList.result}if(this.isUpdate){this.showBeforeUpdate(this.p.GUID)}},showBeforeUpdate:function(e){var t=$DS.selectBySql(null,"select * from dm_form_cproperties where guid='"+e+"'","修改回显属性数据查询异常");if(t.isError){alert(t.errMsg);return false}else{t=t.result}if(!t[0])return false;this.p.GUID=t[0].GUID;this.p.CTRLNAME=t[0].CTRLNAME;this.p.PNAME=t[0].PNAME;this.p.PCNAME=t[0].PCNAME;this.p.GROUPNAME=t[0].GROUPNAME;this.p.SECONDLEVEL=t[0].SECONDLEVEL;this.p.PTYPE=t[0].PTYPE;this.p.MAPPROPERTY=t[0].MAPPROPERTY;this.p.DEFAULTVAL=t[0].DEFAULTVAL;this.p.PORDER=t[0].PORDER;this.p.EXTINFO=t[0].EXTINFO;this.p.EDITOR=t[0].EDITOR;this.p.LISTCODE=t[0].LISTCODE;this.p.READONLY=t[0].READONLY;this.p.ISSHOW=t[0].ISSHOW;this.p.PARSETYPE=t[0].PARSETYPE;this.p.PDESCR=t[0].PDESCR;this.p.DISABLESCOPE=t[0].DISABLESCOPE},saveProperty:function(){if(this.p.PNAME===""){this.$message.error("属性名不能为空");return}if(this.p.PORDER===""){this.$message.error("顺序号不能为空");return}var e=this.isUpdate?"edit":"add";if(e==="add"){var t=this.p.CTRLNAME;var r=this.p.PNAME;var s=$DS.selectBySql(null,"select * from dm_form_cproperties where ctrlname='"+t+"' and pname='"+r+"'","属性名查重询异常");if(s.isError){alert(s.errMsg);return false}else{s=s.result;if(s&&s.length>0){this.$message.error("属性名重复!");return}}}var i=$DS.saveTable(null,e,this.p,"DM_FORM_CPROPERTIES","GUID",function(e){parent.loadCtrlPropertyGrid(v.p.CTRLNAME);parent.alert("保存成功");v.closeWindow()},"保存属性信息异常");if(i.isError){alert(i.errMsg);return false}},closeWindow(){var e=parent.layer.getFrameIndex(window.name);parent.layer.close(e)}}});