var wbnsregex=/<\w+:workbook/;function parse_wb_xml(e,a){var r={AppVersion:{},WBProps:{},WBView:[],Sheets:[],CalcPr:{},xmlns:""};var s=false,t="xmlns";e.match(tagregex).forEach(function e(o){var c=parsexmltag(o);switch(strip_ns(c[0])){case"<?xml":break;case"<workbook":if(o.match(wbnsregex))t="xmlns"+o.match(/<(\w+):/)[1];r.xmlns=c[t];break;case"</workbook>":break;case"<fileVersion":delete c[0];r.AppVersion=c;break;case"<fileVersion/>":break;case"<fileSharing":case"<fileSharing/>":break;case"<workbookPr":delete c[0];r.WBProps=c;break;case"<workbookPr/>":delete c[0];r.WBProps=c;break;case"<workbookProtection":break;case"<workbookProtection/>":break;case"<bookViews>":case"</bookViews>":break;case"<workbookView":delete c[0];r.WBView.push(c);break;case"<sheets>":case"</sheets>":break;case"<sheet":delete c[0];c.name=utf8read(c.name);r.Sheets.push(c);break;case"<functionGroups":case"<functionGroups/>":break;case"<functionGroup":break;case"<externalReferences":case"</externalReferences>":case"<externalReferences>":break;case"<externalReference":break;case"<definedNames/>":break;case"<definedNames>":case"<definedNames":s=true;break;case"</definedNames>":s=false;break;case"<definedName":case"<definedName/>":case"</definedName>":break;case"<calcPr":delete c[0];r.CalcPr=c;break;case"<calcPr/>":delete c[0];r.CalcPr=c;break;case"<oleSize":break;case"<customWorkbookViews>":case"</customWorkbookViews>":case"<customWorkbookViews":break;case"<customWorkbookView":case"</customWorkbookView>":break;case"<pivotCaches>":case"</pivotCaches>":case"<pivotCaches":break;case"<pivotCache":break;case"<smartTagPr":case"<smartTagPr/>":break;case"<smartTagTypes":case"<smartTagTypes>":case"</smartTagTypes>":break;case"<smartTagType":break;case"<webPublishing":case"<webPublishing/>":break;case"<fileRecoveryPr":case"<fileRecoveryPr/>":break;case"<webPublishObjects>":case"<webPublishObjects":case"</webPublishObjects>":break;case"<webPublishObject":break;case"<extLst>":case"</extLst>":case"<extLst/>":break;case"<ext":s=true;break;case"</ext>":s=false;break;case"<ArchID":break;case"<AlternateContent":s=true;break;case"</AlternateContent>":s=false;break;default:if(!s&&a.WTF)throw"unrecognized "+c[0]+" in workbook"}});if(XMLNS.main.indexOf(r.xmlns)===-1)throw new Error("Unknown Namespace: "+r.xmlns);parse_wb_defaults(r);return r}var WB_XML_ROOT=writextag("workbook",null,{xmlns:XMLNS.main[0],"xmlns:r":XMLNS.r});function safe1904(e){try{return parsexmlbool(e.Workbook.WBProps.date1904)?"true":"false"}catch(e){return"false"}}function write_wb_xml(e,a){var r=[XML_HEADER];r[r.length]=WB_XML_ROOT;r[r.length]=writextag("workbookPr",null,{date1904:safe1904(e)});r[r.length]="<sheets>";for(var s=0;s!=e.SheetNames.length;++s)r[r.length]=writextag("sheet",null,{name:e.SheetNames[s].substr(0,31),sheetId:""+(s+1),"r:id":"rId"+(s+1)});r[r.length]="</sheets>";var t=false;for(var s=0;s!=e.SheetNames.length;++s){var o=e.SheetNames[s];var c=e.Sheets[o];if(c["!printHeader"]){if(c["!printHeader"].length!==2){throw"!printHeaders must be an array of length 2: "+c["!printHeader"]}t=true}}if(t){r[r.length]="<definedNames>";for(var s=0;s!=e.SheetNames.length;++s){var o=e.SheetNames[s];var c=e.Sheets[o];if(c["!printHeader"]||c["!printColumns"]){var n=c["!printHeader"];var i=c["!printColumns"];var b="";if(i)b+="'"+o+"'!"+("$"+i[0]+":$"+i[1]);if(i&&n)b+=",";if(n)b+="'"+o+"'!"+("$"+n[0]+":$"+n[1]);console.log("-----------------------------");console.log(b);r[r.length]=writextag("definedName",b,{name:"_xlnm.Print_Titles",localSheetId:""+s})}}r[r.length]="</definedNames>"}if(r.length>2){r[r.length]="</workbook>";r[1]=r[1].replace("/>",">")}return r.join("")}