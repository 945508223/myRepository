function safe_parse_wbrels(e,s){if(!e)return 0;try{e=s.map(function s(t){return[t.name,e["!id"][t.id].Target]})}catch(e){return null}return!e||e.length===0?null:e}function safe_parse_ws(e,s,t,r,a,o,p){try{a[r]=parse_rels(getzipdata(e,t,true),s);o[r]=parse_ws(getzipdata(e,s),s,p,a[r])}catch(e){if(p.WTF)throw e}}var nodirs=function e(s){return s.substr(-1)!="/"};function parse_zip(e,s){make_ssf(SSF);s=s||{};fix_read_opts(s);reset_cp();if(safegetzipfile(e,"META-INF/manifest.xml"))return parse_ods(e,s);var t=keys(e.files).filter(nodirs).sort();var r=parse_ct(getzipdata(e,"[Content_Types].xml"),s);var a=false;var o,p;if(r.workbooks.length===0){p="xl/workbook.xml";if(getzipdata(e,p,true))r.workbooks.push(p)}if(r.workbooks.length===0){p="xl/workbook.bin";if(!getzipfile(e,p,true))throw new Error("Could not find workbook");r.workbooks.push(p);a=true}if(r.workbooks[0].substr(-3)=="bin")a=true;if(a)set_cp(1200);if(!s.bookSheets&&!s.bookProps){strs=[];if(r.sst)strs=parse_sst(getzipdata(e,r.sst.replace(/^\//,"")),r.sst,s);themes={};if(s.cellStyles&&r.themes.length)themes=parse_theme(getzipdata(e,r.themes[0].replace(/^\//,""),true),r.themes[0],s);styles={};if(r.style)styles=parse_sty(getzipdata(e,r.style.replace(/^\//,"")),r.style,s)}var i=parse_wb(getzipdata(e,r.workbooks[0].replace(/^\//,"")),r.workbooks[0],s);var l={},f="";if(r.coreprops.length!==0){f=getzipdata(e,r.coreprops[0].replace(/^\//,""),true);if(f)l=parse_core_props(f);if(r.extprops.length!==0){f=getzipdata(e,r.extprops[0].replace(/^\//,""),true);if(f)parse_ext_props(f,l)}}var n={};if(!s.bookSheets||s.bookProps){if(r.custprops.length!==0){f=getzipdata(e,r.custprops[0].replace(/^\//,""),true);if(f)n=parse_cust_props(f,s)}}var h={};if(s.bookSheets||s.bookProps){if(l.Worksheets&&l.SheetNames.length>0)o=l.SheetNames;else if(i.Sheets)o=i.Sheets.map(function e(s){return s.name});if(s.bookProps){h.Props=l;h.Custprops=n}if(typeof o!=="undefined")h.SheetNames=o;if(s.bookSheets?h.SheetNames:s.bookProps)return h}o={};var c={};if(s.bookDeps&&r.calcchain)c=parse_cc(getzipdata(e,r.calcchain.replace(/^\//,"")),r.calcchain,s);var k=0;var u={};var b,m;if(!l.Worksheets){var _=i.Sheets;l.Worksheets=_.length;l.SheetNames=[];for(var g=0;g!=_.length;++g){l.SheetNames[g]=_[g].name}}var d=a?"bin":"xml";var S="xl/_rels/workbook."+d+".rels";var v=parse_rels(getzipdata(e,S,true),S);if(v)v=safe_parse_wbrels(v,i.Sheets);var w=getzipdata(e,"xl/worksheets/sheet.xml",true)?1:0;for(k=0;k!=l.Worksheets;++k){if(v)b="xl/"+v[k][1].replace(/[\/]?xl\//,"");else{b="xl/worksheets/sheet"+(k+1-w)+"."+d;b=b.replace(/sheet0\./,"sheet.")}m=b.replace(/^(.*)(\/)([^\/]*)$/,"$1/_rels/$3.rels");safe_parse_ws(e,b,m,l.SheetNames[k],u,o,s)}if(r.comments)parse_comments(e,r.comments,o,u,s);h={Directory:r,Workbook:i,Props:l,Custprops:n,Deps:c,Sheets:o,SheetNames:l.SheetNames,Strings:strs,Styles:styles,Themes:themes,SSF:SSF.get_table()};if(s.bookFiles){h.keys=t;h.files=e.files}if(s.bookVBA){if(r.vba.length>0)h.vbaraw=getzipdata(e,r.vba[0],true);else if(r.defaults.bin==="application/vnd.ms-office.vbaProject")h.vbaraw=getzipdata(e,"xl/vbaProject.bin",true)}return h}