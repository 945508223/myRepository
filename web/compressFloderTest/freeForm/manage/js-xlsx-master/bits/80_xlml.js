var attregexg2=/([\w:]+)=((?:")([^"]*)(?:")|(?:')([^']*)(?:'))/g;var attregex2=/([\w:]+)=((?:")(?:[^"]*)(?:")|(?:')(?:[^']*)(?:'))/;var _chr=function(e){return String.fromCharCode(e)};function xlml_parsexmltag(e,a){var r=e.split(/\s+/);var s=[];if(!a)s[0]=r[0];if(r.length===1)return s;var t=e.match(attregexg2),c,l,o,b;if(t)for(b=0;b!=t.length;++b){c=t[b].match(attregex2);if((l=c[1].indexOf(":"))===-1)s[c[1]]=c[2].substr(1,c[2].length-2);else{if(c[1].substr(0,6)==="xmlns:")o="xmlns"+c[1].substr(6);else o=c[1].substr(l+1);s[o]=c[2].substr(1,c[2].length-2)}}return s}function xlml_parsexmltagobj(e){var a=e.split(/\s+/);var r={};if(a.length===1)return r;var s=e.match(attregexg2),t,c,l,o;if(s)for(o=0;o!=s.length;++o){t=s[o].match(attregex2);if((c=t[1].indexOf(":"))===-1)r[t[1]]=t[2].substr(1,t[2].length-2);else{if(t[1].substr(0,6)==="xmlns:")l="xmlns"+t[1].substr(6);else l=t[1].substr(c+1);r[l]=t[2].substr(1,t[2].length-2)}}return r}function xlml_format(e,a){var r=XLMLFormatMap[e]||unescapexml(e);if(r==="General")return SSF._general(a);return SSF.format(r,a)}function xlml_set_custprop(e,a,r,s){switch((r[0].match(/dt:dt="([\w.]+)"/)||["",""])[1]){case"boolean":s=parsexmlbool(s);break;case"i2":case"int":s=parseInt(s,10);break;case"r4":case"float":s=parseFloat(s);break;case"date":case"dateTime.tz":s=new Date(s);break;case"i8":case"string":case"fixed":case"uuid":case"bin.base64":break;default:throw"bad custprop:"+r[0]}e[unescapexml(a[3])]=s}function safe_format_xlml(e,a,r){try{if(e.t==="e"){e.w=e.w||BErr[e.v]}else if(a==="General"){if(e.t==="n"){if((e.v|0)===e.v)e.w=SSF._general_int(e.v);else e.w=SSF._general_num(e.v)}else e.w=SSF._general(e.v)}else e.w=xlml_format(a||"General",e.v);if(r.cellNF)e.z=XLMLFormatMap[a]||a||"General"}catch(e){if(r.WTF)throw e}}function process_style_xlml(e,a,r){if(r.cellStyles){if(a.Interior){var s=a.Interior;if(s.Pattern)s.patternType=XLMLPatternTypeMap[s.Pattern]||s.Pattern}}e[a.ID]=a}function parse_xlml_data(e,a,r,s,t,c,l,o,b){var i="General",n=s.StyleID,k={};b=b||{};var f=[];if(n===undefined&&o)n=o.StyleID;if(n===undefined&&l)n=l.StyleID;while(c[n]!==undefined){if(c[n].nf)i=c[n].nf;if(c[n].Interior)f.push(c[n].Interior);if(!c[n].Parent)break;n=c[n].Parent}switch(r.Type){case"Boolean":s.t="b";s.v=parsexmlbool(e);break;case"String":s.t="s";s.r=xlml_fixstr(unescapexml(e));s.v=e.indexOf("<")>-1?a:s.r;break;case"DateTime":s.v=(Date.parse(e)-new Date(Date.UTC(1899,11,30)))/(24*60*60*1e3);if(s.v!==s.v)s.v=unescapexml(e);else if(s.v>=1&&s.v<60)s.v=s.v-1;if(!i||i=="General")i="yyyy-mm-dd";case"Number":if(s.v===undefined)s.v=+e;if(!s.t)s.t="n";break;case"Error":s.t="e";s.v=RBErr[e];s.w=e;break;default:s.t="s";s.v=xlml_fixstr(a);break}safe_format_xlml(s,i,b);if(b.cellFormula!=null&&s.Formula){s.f=rc_to_a1(unescapexml(s.Formula),t);s.Formula=undefined}if(b.cellStyles){f.forEach(function(e){if(!k.patternType&&e.patternType)k.patternType=e.patternType});s.s=k}s.ixfe=s.StyleID!==undefined?s.StyleID:"Default"}function xlml_clean_comment(e){e.t=e.v;e.v=e.w=e.ixfe=undefined}function xlml_normalize(e){if(has_buf&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e==="string")return e;throw"badf"}var xlmlregex=/<(\/?)([a-z0-9]*:|)(\w+)[^>]*>/gm;function parse_xlml_xml(e,a){var r=xlml_normalize(e);var s;var t=[],c;var l={},o=[],b={},i="";var n={},k={},f={},m,u;var d=0,p=0;var h={s:{r:1e6,c:1e6},e:{r:0,c:0}};var g={},x={};var S="",w=0;var v=[];var C={},y={},_=0,T={};var I=[],F={};var P=[],R;xlmlregex.lastIndex=0;while(s=xlmlregex.exec(r))switch(s[3]){case"Data":if(t[t.length-1][1])break;if(s[1]==="/")parse_xlml_data(r.slice(u,s.index),S,m,t[t.length-1][0]=="Comment"?F:k,{c:d,r:p},g,P[d],f,a);else{S="";m=xlml_parsexmltag(s[0]);u=s.index+s[0].length}break;case"Cell":if(s[1]==="/"){if(I.length>0)k.c=I;if((!a.sheetRows||a.sheetRows>p)&&k.v!==undefined)b[encode_col(d)+encode_row(p)]=k;if(k.HRef){k.l={Target:k.HRef,tooltip:k.HRefScreenTip};k.HRef=k.HRefScreenTip=undefined}if(k.MergeAcross||k.MergeDown){var D=d+(parseInt(k.MergeAcross,10)|0);var A=p+(parseInt(k.MergeDown,10)|0);v.push({s:{c:d,r:p},e:{c:D,r:A}})}++d;if(k.MergeAcross)d+=+k.MergeAcross}else{k=xlml_parsexmltagobj(s[0]);if(k.Index)d=+k.Index-1;if(d<h.s.c)h.s.c=d;if(d>h.e.c)h.e.c=d;if(s[0].substr(-2)==="/>")++d;I=[]}break;case"Row":if(s[1]==="/"||s[0].substr(-2)==="/>"){if(p<h.s.r)h.s.r=p;if(p>h.e.r)h.e.r=p;if(s[0].substr(-2)==="/>"){f=xlml_parsexmltag(s[0]);if(f.Index)p=+f.Index-1}d=0;++p}else{f=xlml_parsexmltag(s[0]);if(f.Index)p=+f.Index-1}break;case"Worksheet":if(s[1]==="/"){if((c=t.pop())[0]!==s[3])throw"Bad state: "+c;o.push(i);if(h.s.r<=h.e.r&&h.s.c<=h.e.c)b["!ref"]=encode_range(h);if(v.length)b["!merges"]=v;l[i]=b}else{h={s:{r:1e6,c:1e6},e:{r:0,c:0}};p=d=0;t.push([s[3],false]);c=xlml_parsexmltag(s[0]);i=c.Name;b={};v=[]}break;case"Table":if(s[1]==="/"){if((c=t.pop())[0]!==s[3])throw"Bad state: "+c}else if(s[0].slice(-2)=="/>")break;else{n=xlml_parsexmltag(s[0]);t.push([s[3],false]);P=[]}break;case"Style":if(s[1]==="/")process_style_xlml(g,x,a);else x=xlml_parsexmltag(s[0]);break;case"NumberFormat":x.nf=xlml_parsexmltag(s[0]).Format||"General";break;case"Column":if(t[t.length-1][0]!=="Table")break;R=xlml_parsexmltag(s[0]);P[R.Index-1||P.length]=R;for(var L=0;L<+R.Span;++L)P[P.length]=R;break;case"NamedRange":break;case"NamedCell":break;case"B":break;case"I":break;case"U":break;case"S":break;case"Sub":break;case"Sup":break;case"Span":break;case"Border":break;case"Alignment":break;case"Borders":break;case"Font":if(s[0].substr(-2)==="/>")break;else if(s[1]==="/")S+=r.slice(w,s.index);else w=s.index+s[0].length;break;case"Interior":if(!a.cellStyles)break;x.Interior=xlml_parsexmltag(s[0]);break;case"Protection":break;case"Author":case"Title":case"Description":case"Created":case"Keywords":case"Subject":case"Category":case"Company":case"LastAuthor":case"LastSaved":case"LastPrinted":case"Version":case"Revision":case"TotalTime":case"HyperlinkBase":case"Manager":if(s[0].substr(-2)==="/>")break;else if(s[1]==="/")xlml_set_prop(C,s[3],r.slice(_,s.index));else _=s.index+s[0].length;break;case"Paragraphs":break;case"Styles":case"Workbook":if(s[1]==="/"){if((c=t.pop())[0]!==s[3])throw"Bad state: "+c}else t.push([s[3],false]);break;case"Comment":if(s[1]==="/"){if((c=t.pop())[0]!==s[3])throw"Bad state: "+c;xlml_clean_comment(F);I.push(F)}else{t.push([s[3],false]);c=xlml_parsexmltag(s[0]);F={a:c.Author}}break;case"Name":break;case"ComponentOptions":case"DocumentProperties":case"CustomDocumentProperties":case"OfficeDocumentSettings":case"PivotTable":case"PivotCache":case"Names":case"MapInfo":case"PageBreaks":case"QueryTable":case"DataValidation":case"AutoFilter":case"Sorting":case"Schema":case"data":case"ConditionalFormatting":case"SmartTagType":case"SmartTags":case"ExcelWorkbook":case"WorkbookOptions":case"WorksheetOptions":if(s[1]==="/"){if((c=t.pop())[0]!==s[3])throw"Bad state: "+c}else if(s[0].charAt(s[0].length-2)!=="/")t.push([s[3],true]);break;default:var N=true;switch(t[t.length-1][0]){case"OfficeDocumentSettings":switch(s[3]){case"AllowPNG":break;case"RemovePersonalInformation":break;case"DownloadComponents":break;case"LocationOfComponents":break;case"Colors":break;case"Color":break;case"Index":break;case"RGB":break;case"PixelsPerInch":break;case"TargetScreenSize":break;case"ReadOnlyRecommended":break;default:N=false}break;case"ComponentOptions":switch(s[3]){case"Toolbar":break;case"HideOfficeLogo":break;case"SpreadsheetAutoFit":break;case"Label":break;case"Caption":break;case"MaxHeight":break;case"MaxWidth":break;case"NextSheetNumber":break;default:N=false}break;case"ExcelWorkbook":switch(s[3]){case"WindowHeight":break;case"WindowWidth":break;case"WindowTopX":break;case"WindowTopY":break;case"TabRatio":break;case"ProtectStructure":break;case"ProtectWindows":break;case"ActiveSheet":break;case"DisplayInkNotes":break;case"FirstVisibleSheet":break;case"SupBook":break;case"SheetName":break;case"SheetIndex":break;case"SheetIndexFirst":break;case"SheetIndexLast":break;case"Dll":break;case"AcceptLabelsInFormulas":break;case"DoNotSaveLinkValues":break;case"Date1904":break;case"Iteration":break;case"MaxIterations":break;case"MaxChange":break;case"Path":break;case"Xct":break;case"Count":break;case"SelectedSheets":break;case"Calculation":break;case"Uncalced":break;case"StartupPrompt":break;case"Crn":break;case"ExternName":break;case"Formula":break;case"ColFirst":break;case"ColLast":break;case"WantAdvise":break;case"Boolean":break;case"Error":break;case"Text":break;case"OLE":break;case"NoAutoRecover":break;case"PublishObjects":break;case"DoNotCalculateBeforeSave":break;case"Number":break;case"RefModeR1C1":break;case"EmbedSaveSmartTags":break;default:N=false}break;case"WorkbookOptions":switch(s[3]){case"OWCVersion":break;case"Height":break;case"Width":break;default:N=false}break;case"WorksheetOptions":switch(s[3]){case"Unsynced":break;case"Visible":break;case"Print":break;case"Panes":break;case"Scale":break;case"Pane":break;case"Number":break;case"Layout":break;case"Header":break;case"Footer":break;case"PageSetup":break;case"PageMargins":break;case"Selected":break;case"ProtectObjects":break;case"EnableSelection":break;case"ProtectScenarios":break;case"ValidPrinterInfo":break;case"HorizontalResolution":break;case"VerticalResolution":break;case"NumberofCopies":break;case"ActiveRow":break;case"ActiveCol":break;case"ActivePane":break;case"TopRowVisible":break;case"TopRowBottomPane":break;case"LeftColumnVisible":break;case"LeftColumnRightPane":break;case"FitToPage":break;case"RangeSelection":break;case"PaperSizeIndex":break;case"PageLayoutZoom":break;case"PageBreakZoom":break;case"FilterOn":break;case"DoNotDisplayGridlines":break;case"SplitHorizontal":break;case"SplitVertical":break;case"FreezePanes":break;case"FrozenNoSplit":break;case"FitWidth":break;case"FitHeight":break;case"CommentsLayout":break;case"Zoom":break;case"LeftToRight":break;case"Gridlines":break;case"AllowSort":break;case"AllowFilter":break;case"AllowInsertRows":break;case"AllowDeleteRows":break;case"AllowInsertCols":break;case"AllowDeleteCols":break;case"AllowInsertHyperlinks":break;case"AllowFormatCells":break;case"AllowSizeCols":break;case"AllowSizeRows":break;case"NoSummaryRowsBelowDetail":break;case"TabColorIndex":break;case"DoNotDisplayHeadings":break;case"ShowPageLayoutZoom":break;case"NoSummaryColumnsRightDetail":break;case"BlackAndWhite":break;case"DoNotDisplayZeros":break;case"DisplayPageBreak":break;case"RowColHeadings":break;case"DoNotDisplayOutline":break;case"NoOrientation":break;case"AllowUsePivotTables":break;case"ZeroHeight":break;case"ViewableRange":break;case"Selection":break;case"ProtectContents":break;default:N=false}break;case"PivotTable":case"PivotCache":switch(s[3]){case"ImmediateItemsOnDrop":break;case"ShowPageMultipleItemLabel":break;case"CompactRowIndent":break;case"Location":break;case"PivotField":break;case"Orientation":break;case"LayoutForm":break;case"LayoutSubtotalLocation":break;case"LayoutCompactRow":break;case"Position":break;case"PivotItem":break;case"DataType":break;case"DataField":break;case"SourceName":break;case"ParentField":break;case"PTLineItems":break;case"PTLineItem":break;case"CountOfSameItems":break;case"Item":break;case"ItemType":break;case"PTSource":break;case"CacheIndex":break;case"ConsolidationReference":break;case"FileName":break;case"Reference":break;case"NoColumnGrand":break;case"NoRowGrand":break;case"BlankLineAfterItems":break;case"Hidden":break;case"Subtotal":break;case"BaseField":break;case"MapChildItems":break;case"Function":break;case"RefreshOnFileOpen":break;case"PrintSetTitles":break;case"MergeLabels":break;case"DefaultVersion":break;case"RefreshName":break;case"RefreshDate":break;case"RefreshDateCopy":break;case"VersionLastRefresh":break;case"VersionLastUpdate":break;case"VersionUpdateableMin":break;case"VersionRefreshableMin":break;case"Calculation":break;default:N=false}break;case"PageBreaks":switch(s[3]){case"ColBreaks":break;case"ColBreak":break;case"RowBreaks":break;case"RowBreak":break;case"ColStart":break;case"ColEnd":break;case"RowEnd":break;default:N=false}break;case"AutoFilter":switch(s[3]){case"AutoFilterColumn":break;case"AutoFilterCondition":break;case"AutoFilterAnd":break;case"AutoFilterOr":break;default:N=false}break;case"QueryTable":switch(s[3]){case"Id":break;case"AutoFormatFont":break;case"AutoFormatPattern":break;case"QuerySource":break;case"QueryType":break;case"EnableRedirections":break;case"RefreshedInXl9":break;case"URLString":break;case"HTMLTables":break;case"Connection":break;case"CommandText":break;case"RefreshInfo":break;case"NoTitles":break;case"NextId":break;case"ColumnInfo":break;case"OverwriteCells":break;case"DoNotPromptForFile":break;case"TextWizardSettings":break;case"Source":break;case"Number":break;case"Decimal":break;case"ThousandSeparator":break;case"TrailingMinusNumbers":break;case"FormatSettings":break;case"FieldType":break;case"Delimiters":break;case"Tab":break;case"Comma":break;case"AutoFormatName":break;case"VersionLastEdit":break;case"VersionLastRefresh":break;default:N=false}break;case"Sorting":case"ConditionalFormatting":case"DataValidation":switch(s[3]){case"Range":break;case"Type":break;case"Min":break;case"Max":break;case"Sort":break;case"Descending":break;case"Order":break;case"CaseSensitive":break;case"Value":break;case"ErrorStyle":break;case"ErrorMessage":break;case"ErrorTitle":break;case"CellRangeList":break;case"InputMessage":break;case"InputTitle":break;case"ComboHide":break;case"InputHide":break;case"Condition":break;case"Qualifier":break;case"UseBlank":break;case"Value1":break;case"Value2":break;case"Format":break;default:N=false}break;case"MapInfo":case"Schema":case"data":switch(s[3]){case"Map":break;case"Entry":break;case"Range":break;case"XPath":break;case"Field":break;case"XSDType":break;case"FilterOn":break;case"Aggregate":break;case"ElementType":break;case"AttributeType":break;case"schema":case"element":case"complexType":case"datatype":case"all":case"attribute":case"extends":break;case"row":break;default:N=false}break;case"SmartTags":break;default:N=false;break}if(N)break;if(!t[t.length-1][1])throw"Unrecognized tag: "+s[3]+"|"+t.join("|");if(t[t.length-1][0]==="CustomDocumentProperties"){if(s[0].substr(-2)==="/>")break;else if(s[1]==="/")xlml_set_custprop(y,s,T,r.slice(_,s.index));else{T=s;_=s.index+s[0].length}break}if(a.WTF)throw"Unrecognized tag: "+s[3]+"|"+t.join("|")}var B={};if(!a.bookSheets&&!a.bookProps)B.Sheets=l;B.SheetNames=o;B.SSF=SSF.get_table();B.Props=C;B.Custprops=y;return B}function parse_xlml(e,a){fix_read_opts(a=a||{});switch(a.type||"base64"){case"base64":return parse_xlml_xml(Base64.decode(e),a);case"binary":case"buffer":case"file":return parse_xlml_xml(e,a);case"array":return parse_xlml_xml(e.map(_chr).join(""),a)}}function write_xlml(e,a){}