function parse_FILETIME(r){var e=r.read_shift(4),a=r.read_shift(4);return new Date((a/1e7*Math.pow(2,32)+e/1e7-11644473600)*1e3).toISOString().replace(/\.000/,"")}function parse_lpstr(r,e,a){var t=r.read_shift(0,"lpstr");if(a)r.l+=4-(t.length+1&3)&3;return t}function parse_lpwstr(r,e,a){var t=r.read_shift(0,"lpwstr");if(a)r.l+=4-(t.length+1&3)&3;return t}function parse_VtStringBase(r,e,a){if(e===31)return parse_lpwstr(r);return parse_lpstr(r,e,a)}function parse_VtString(r,e,a){return parse_VtStringBase(r,e,a===false?0:4)}function parse_VtUnalignedString(r,e){if(!e)throw new Error("dafuq?");return parse_VtStringBase(r,e,0)}function parse_VtVecUnalignedLpstrValue(r){var e=r.read_shift(4);var a=[];for(var t=0;t!=e;++t)a[t]=r.read_shift(0,"lpstr");return a}function parse_VtVecUnalignedLpstr(r){return parse_VtVecUnalignedLpstrValue(r)}function parse_VtHeadingPair(r){var e=parse_TypedPropertyValue(r,VT_USTR);var a=parse_TypedPropertyValue(r,VT_I4);return[e,a]}function parse_VtVecHeadingPairValue(r){var e=r.read_shift(4);var a=[];for(var t=0;t!=e/2;++t)a.push(parse_VtHeadingPair(r));return a}function parse_VtVecHeadingPair(r){return parse_VtVecHeadingPairValue(r)}function parse_dictionary(r,e){var a=r.read_shift(4);var t={};for(var i=0;i!=a;++i){var s=r.read_shift(4);var n=r.read_shift(4);t[s]=r.read_shift(n,e===1200?"utf16le":"utf8").replace(chr0,"").replace(chr1,"!")}if(r.l&3)r.l=r.l>>2+1<<2;return t}function parse_BLOB(r){var e=r.read_shift(4);var a=r.slice(r.l,r.l+e);if(e&3>0)r.l+=4-(e&3)&3;return a}function parse_ClipboardData(r){var e={};e.Size=r.read_shift(4);r.l+=e.Size;return e}function parse_VtVector(r,e){}function parse_TypedPropertyValue(r,e,a){var t=r.read_shift(2),i,s=a||{};r.l+=2;if(e!==VT_VARIANT)if(t!==e&&VT_CUSTOM.indexOf(e)===-1)throw new Error("Expected type "+e+" saw "+t);switch(e===VT_VARIANT?t:e){case 2:i=r.read_shift(2,"i");if(!s.raw)r.l+=2;return i;case 3:i=r.read_shift(4,"i");return i;case 11:return r.read_shift(4)!==0;case 19:i=r.read_shift(4);return i;case 30:return parse_lpstr(r,t,4).replace(chr0,"");case 31:return parse_lpwstr(r);case 64:return parse_FILETIME(r);case 65:return parse_BLOB(r);case 71:return parse_ClipboardData(r);case 80:return parse_VtString(r,t,!s.raw&&4).replace(chr0,"");case 81:return parse_VtUnalignedString(r,t,4).replace(chr0,"");case 4108:return parse_VtVecHeadingPair(r);case 4126:return parse_VtVecUnalignedLpstr(r);default:throw new Error("TypedPropertyValue unrecognized type "+e+" "+t)}}function parse_PropertySet(r,e){var a=r.l;var t=r.read_shift(4);var i=r.read_shift(4);var s=[],n=0;var f=0;var c=-1,p;for(n=0;n!=i;++n){var _=r.read_shift(4);var l=r.read_shift(4);s[n]=[_,l+a]}var o={};for(n=0;n!=i;++n){if(r.l!==s[n][1]){var u=true;if(n>0&&e)switch(e[s[n-1][0]].t){case 2:if(r.l+2===s[n][1]){r.l+=2;u=false}break;case 80:if(r.l<=s[n][1]){r.l=s[n][1];u=false}break;case 4108:if(r.l<=s[n][1]){r.l=s[n][1];u=false}break}if(!e&&r.l<=s[n][1]){u=false;r.l=s[n][1]}if(u)throw new Error("Read Error: Expected address "+s[n][1]+" at "+r.l+" :"+n)}if(e){var d=e[s[n][0]];o[d.n]=parse_TypedPropertyValue(r,d.t,{raw:true});if(d.p==="version")o[d.n]=String(o[d.n]>>16)+"."+String(o[d.n]&65535);if(d.n=="CodePage")switch(o[d.n]){case 0:o[d.n]=1252;case 1e4:case 1252:case 874:case 1250:case 1251:case 1253:case 1254:case 1255:case 1256:case 1257:case 1258:case 932:case 936:case 949:case 950:case 1200:case 1201:case 65e3:case-536:case 65001:case-535:set_cp(f=o[d.n]);break;default:throw new Error("Unsupported CodePage: "+o[d.n])}}else{if(s[n][0]===1){f=o.CodePage=parse_TypedPropertyValue(r,VT_I2);set_cp(f);if(c!==-1){var h=r.l;r.l=s[c][1];p=parse_dictionary(r,f);r.l=h}}else if(s[n][0]===0){if(f===0){c=n;r.l=s[n+1][1];continue}p=parse_dictionary(r,f)}else{var v=p[s[n][0]];var g;switch(r[r.l]){case 65:r.l+=4;g=parse_BLOB(r);break;case 30:r.l+=4;g=parse_VtString(r,r[r.l-4]);break;case 31:r.l+=4;g=parse_VtString(r,r[r.l-4]);break;case 3:r.l+=4;g=r.read_shift(4,"i");break;case 19:r.l+=4;g=r.read_shift(4);break;case 5:r.l+=4;g=r.read_shift(8,"f");break;case 11:r.l+=4;g=parsebool(r,4);break;case 64:r.l+=4;g=new Date(parse_FILETIME(r));break;default:throw new Error("unparsed value: "+r[r.l])}o[v]=g}}}r.l=a+t;return o}function parse_PropertySetStream(r,e){var a=r.content;prep_blob(a,0);var t,i,s,n,f;a.chk("feff","Byte Order: ");var c=a.read_shift(2);var p=a.read_shift(4);a.chk(CFB.utils.consts.HEADER_CLSID,"CLSID: ");t=a.read_shift(4);if(t!==1&&t!==2)throw"Unrecognized #Sets: "+t;i=a.read_shift(16);n=a.read_shift(4);if(t===1&&n!==a.l)throw"Length mismatch";else if(t===2){s=a.read_shift(16);f=a.read_shift(4)}var _=parse_PropertySet(a,e);var l={SystemIdentifier:p};for(var o in _)l[o]=_[o];l.FMTID=i;if(t===1)return l;if(a.l!==f)throw"Length mismatch 2: "+a.l+" !== "+f;var u;try{u=parse_PropertySet(a,null)}catch(r){}for(o in u)l[o]=u[o];l.FMTID=[i,s];return l}function parsenoop2(r,e){r.read_shift(e);return null}function parslurp(r,e,a){var t=[],i=r.l+e;while(r.l<i)t.push(a(r,i-r.l));if(i!==r.l)throw new Error("Slurp error");return t}function parslurp2(r,e,a){var t=[],i=r.l+e,s=r.read_shift(2);while(s--!==0)t.push(a(r,i-r.l));if(i!==r.l)throw new Error("Slurp error");return t}function parsebool(r,e){return r.read_shift(e)===1}function parseuint16(r){return r.read_shift(2,"u")}function parseuint16a(r,e){return parslurp(r,e,parseuint16)}var parse_Boolean=parsebool;function parse_Bes(r){var e=r.read_shift(1),a=r.read_shift(1);return a===1?e:e===1}function parse_ShortXLUnicodeString(r,e,a){var t=r.read_shift(1);var i=1,s="sbcs-cont";var n=current_codepage;if(a&&a.biff>=8)current_codepage=1200;if(a===undefined||a.biff!==5){var f=r.read_shift(1);if(f){i=2;s="dbcs-cont"}}var c=t?r.read_shift(t,s):"";current_codepage=n;return c}function parse_XLUnicodeRichExtendedString(r){var e=current_codepage;current_codepage=1200;var a=r.read_shift(2),t=r.read_shift(1);var i=t&1,s=t&4,n=t&8;var f=1+(t&1);var c,p;var _={};if(n)c=r.read_shift(2);if(s)p=r.read_shift(4);var l=t&1?"dbcs-cont":"sbcs-cont";var o=a===0?"":r.read_shift(a,l);if(n)r.l+=4*c;if(s)r.l+=p;_.t=o;if(!n){_.raw="<t>"+_.t+"</t>";_.r=_.t}current_codepage=e;return _}function parse_XLUnicodeStringNoCch(r,e,a){var t;var i=r.read_shift(1);if(i===0){t=r.read_shift(e,"sbcs-cont")}else{t=r.read_shift(e,"dbcs-cont")}return t}function parse_XLUnicodeString(r,e,a){var t=r.read_shift(a!==undefined&&a.biff>0&&a.biff<8?1:2);if(t===0){r.l++;return""}return parse_XLUnicodeStringNoCch(r,t,a)}function parse_XLUnicodeString2(r,e,a){if(a.biff!==5&&a.biff!==2)return parse_XLUnicodeString(r,e,a);var t=r.read_shift(1);if(t===0){r.l++;return""}return r.read_shift(t,"sbcs-cont")}var parse_ControlInfo=parsenoop;var parse_URLMoniker=function(r,e){var a=r.read_shift(4),t=r.l;var i=false;if(a>24){r.l+=a-24;if(r.read_shift(16)==="795881f43b1d7f48af2c825dc4852763")i=true;r.l=t}var s=r.read_shift((i?a-24:a)>>1,"utf16le").replace(chr0,"");if(i)r.l+=24;return s};var parse_FileMoniker=function(r,e){var a=r.read_shift(2);var t=r.read_shift(4);var i=r.read_shift(t,"cstr");var s=r.read_shift(2);var n=r.read_shift(2);var f=r.read_shift(4);if(f===0)return i.replace(/\\/g,"/");var c=r.read_shift(4);var p=r.read_shift(2);var _=r.read_shift(c>>1,"utf16le").replace(chr0,"");return _};var parse_HyperlinkMoniker=function(r,e){var a=r.read_shift(16);e-=16;switch(a){case"e0c9ea79f9bace118c8200aa004ba90b":return parse_URLMoniker(r,e);case"0303000000000000c000000000000046":return parse_FileMoniker(r,e);default:throw"unsupported moniker "+a}};var parse_HyperlinkString=function(r,e){var a=r.read_shift(4);var t=r.read_shift(a,"utf16le").replace(chr0,"");return t};var parse_Hyperlink=function(r,e){var a=r.l+e;var t=r.read_shift(4);if(t!==2)throw new Error("Unrecognized streamVersion: "+t);var i=r.read_shift(2);r.l+=2;var s,n,f,c,p,_,l;if(i&16)s=parse_HyperlinkString(r,a-r.l);if(i&128)n=parse_HyperlinkString(r,a-r.l);if((i&257)===257)f=parse_HyperlinkString(r,a-r.l);if((i&257)===1)c=parse_HyperlinkMoniker(r,a-r.l);if(i&8)p=parse_HyperlinkString(r,a-r.l);if(i&32)_=r.read_shift(16);if(i&64)l=parse_FILETIME(r,8);r.l=a;var o=n||f||c;if(p)o+="#"+p;return{Target:o}};function parse_LongRGBA(r,e){var a=r.read_shift(1),t=r.read_shift(1),i=r.read_shift(1),s=r.read_shift(1);return[a,t,i,s]}function parse_LongRGB(r,e){var a=parse_LongRGBA(r,e);a[3]=0;return a}