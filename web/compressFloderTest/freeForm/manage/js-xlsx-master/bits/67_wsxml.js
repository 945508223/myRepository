function parse_ws_xml_dim(e,r){var t=safe_decode_range(r);if(t.s.r<=t.e.r&&t.s.c<=t.e.c&&t.s.r>=0&&t.s.c>=0)e["!ref"]=encode_range(t)}var mergecregex=/<mergeCell ref="[A-Z0-9:]+"\s*\/>/g;var sheetdataregex=/<(?:\w+:)?sheetData>([^\u2603]*)<\/(?:\w+:)?sheetData>/;var hlinkregex=/<hyperlink[^>]*\/>/g;var dimregex=/"(\w*:\w*)"/;var colregex=/<col[^>]*\/>/g;function parse_ws_xml(e,r,t){if(!e)return e;var a={};var n=e.indexOf("<dimension");if(n>0){var l=e.substr(n,50).match(dimregex);if(l!=null)parse_ws_xml_dim(a,l[1])}var i=[];if(e.indexOf("</mergeCells>")!==-1){var s=e.match(mergecregex);for(n=0;n!=s.length;++n)i[n]=safe_decode_range(s[n].substr(s[n].indexOf('"')+1))}var f=[];if(r.cellStyles&&e.indexOf("</cols>")!==-1){var c=e.match(colregex);parse_ws_xml_cols(f,c)}var o={s:{r:1e6,c:1e6},e:{r:0,c:0}};var u=e.match(sheetdataregex);if(u)parse_ws_xml_data(u[1],a,r,o);if(e.indexOf("</hyperlinks>")!==-1)parse_ws_xml_hlinks(a,e.match(hlinkregex),t);if(!a["!ref"]&&o.e.c>=o.s.c&&o.e.r>=o.s.r)a["!ref"]=encode_range(o);if(r.sheetRows>0&&a["!ref"]){var d=safe_decode_range(a["!ref"]);if(r.sheetRows<+d.e.r){d.e.r=r.sheetRows-1;if(d.e.r>o.e.r)d.e.r=o.e.r;if(d.e.r<d.s.r)d.s.r=d.e.r;if(d.e.c>o.e.c)d.e.c=o.e.c;if(d.e.c<d.s.c)d.s.c=d.e.c;a["!fullref"]=a["!ref"];a["!ref"]=encode_range(d)}}if(i.length>0)a["!merges"]=i;if(f.length>0)a["!cols"]=f;return a}function write_ws_xml_merges(e){if(e.length==0)return"";var r='<mergeCells count="'+e.length+'">';for(var t=0;t!=e.length;++t)r+='<mergeCell ref="'+encode_range(e[t])+'"/>';return r+"</mergeCells>"}function write_ws_xml_pagesetup(e){var r=writextag("pageSetup",null,{scale:e.scale||"100",orientation:e.orientation||"portrait",horizontalDpi:e.horizontalDpi||"4294967292",verticalDpi:e.verticalDpi||"4294967292"});return r}function parse_ws_xml_hlinks(e,r,t){for(var a=0;a!=r.length;++a){var n=parsexmltag(r[a],true);if(!n.ref)return;var l=t?t["!id"][n.id]:null;if(l){n.Target=l.Target;if(n.location)n.Target+="#"+n.location;n.Rel=l}else{n.Target=n.location;l={Target:n.location,TargetMode:"Internal"};n.Rel=l}var i=safe_decode_range(n.ref);for(var s=i.s.r;s<=i.e.r;++s)for(var f=i.s.c;f<=i.e.c;++f){var c=encode_cell({c:f,r:s});if(!e[c])e[c]={t:"stub",v:undefined};e[c].l=n}}}function parse_ws_xml_cols(e,r){var t=false;for(var a=0;a!=r.length;++a){var n=parsexmltag(r[a],true);var l=parseInt(n.min,10)-1,i=parseInt(n.max,10)-1;delete n.min;delete n.max;if(!t&&n.width){t=true;find_mdw(+n.width,n)}if(n.width){n.wpx=width2px(+n.width);n.wch=px2char(n.wpx);n.MDW=MDW}while(l<=i)e[l++]=n}}function write_ws_xml_cols(e,r){var t=["<cols>"],a,n;for(var l=0;l!=r.length;++l){if(!(a=r[l]))continue;var i={min:l+1,max:l+1};n=-1;if(a.wpx)n=px2char(a.wpx);else if(a.wch)n=a.wch;if(n>-1){i.width=char2width(n);i.customWidth=1}t[t.length]=writextag("col",null,i)}t[t.length]="</cols>";return t.join("")}function write_ws_xml_cell(e,r,t,a,n,l){if(e.v===undefined&&e.s===undefined)return"";var i="";var s=e.t,f=e.v;switch(e.t){case"b":i=e.v?"1":"0";break;case"n":i=""+e.v;break;case"e":i=BErr[e.v];break;case"d":if(a.cellDates)i=new Date(e.v).toISOString();else{e.t="n";i=""+(e.v=datenum(e.v));if(typeof e.z==="undefined")e.z=SSF._table[14]}break;default:i=e.v;break}var c=writetag("v",escapexml(i)),o={r:r};var u=get_cell_style(a.cellXfs,e,a);if(u!==0)o.s=u;switch(e.t){case"n":break;case"d":o.t="d";break;case"b":o.t="b";break;case"e":o.t="e";break;default:if(a.bookSST){c=writetag("v",""+get_sst_id(a.Strings,e.v));o.t="s";break}o.t="str";break}if(e.t!=s){e.t=s;e.v=f}return writextag("c",c,o)}var parse_ws_xml_data=function e(){var r=/<(?:\w+:)?c[ >]/,t=/<\/(?:\w+:)?row>/;var a=/r=["']([^"']*)["']/,n=/<is>([\S\s]*?)<\/is>/;var l=matchtag("v"),i=matchtag("f");return function e(s,f,c,o){var u=0,d="",g=[],h=[],w=0,_=0,v=0,m="",x;var p,b=0,k=0;var S;var y=0,D=0,C=Array.isArray(styles.CellXf),I;for(var R=s.split(t),L=0,T=R.length;L!=T;++L){d=R[L].trim();var B=d.length;if(B===0)continue;for(u=0;u<B;++u)if(d.charCodeAt(u)===62)break;++u;p=parsexmltag(d.substr(0,u),true);b=typeof p.r!=="undefined"?parseInt(p.r,10):b+1;k=-1;if(c.sheetRows&&c.sheetRows<b)continue;if(o.s.r>b-1)o.s.r=b-1;if(o.e.r<b-1)o.e.r=b-1;g=d.substr(u).split(r);for(u=typeof p.r==="undefined"?0:1;u!=g.length;++u){d=g[u].trim();if(d.length===0)continue;h=d.match(a);w=u;_=0;v=0;d="<c "+(d.substr(0,1)=="<"?">":"")+d;if(h!==null&&h.length===2){w=0;m=h[1];for(_=0;_!=m.length;++_){if((v=m.charCodeAt(_)-64)<1||v>26)break;w=26*w+v}--w;k=w}else++k;for(_=0;_!=d.length;++_)if(d.charCodeAt(_)===62)break;++_;p=parsexmltag(d.substr(0,_),true);if(!p.r)p.r=utils.encode_cell({r:b-1,c:k});m=d.substr(_);x={t:""};if((h=m.match(l))!==null&&h[1]!=="")x.v=unescapexml(h[1]);if(c.cellFormula&&(h=m.match(i))!==null)x.f=unescapexml(h[1]);if(p.t===undefined&&p.s===undefined&&x.v===undefined){if(!c.sheetStubs)continue;x.t="stub"}else x.t=p.t||"n";if(o.s.c>w)o.s.c=w;if(o.e.c<w)o.e.c=w;switch(x.t){case"n":x.v=parseFloat(x.v);if(isNaN(x.v))x.v="";break;case"s":S=strs[parseInt(x.v,10)];x.v=S.t;x.r=S.r;if(c.cellHTML)x.h=S.h;break;case"str":x.t="s";x.v=x.v!=null?utf8read(x.v):"";if(c.cellHTML)x.h=x.v;break;case"inlineStr":h=m.match(n);x.t="s";if(h!==null){S=parse_si(h[1]);x.v=S.t}else x.v="";break;case"b":x.v=parsexmlbool(x.v);break;case"d":if(!c.cellDates){x.v=datenum(x.v);x.t="n"}break;case"e":x.w=x.v;x.v=RBErr[x.v];break}y=D=0;if(C&&p.s!==undefined){I=styles.CellXf[p.s];if(c.cellStyles){x.s=get_cell_style_csf(I)}if(I!=null){if(I.numFmtId!=null)y=I.numFmtId;if(c.cellStyles&&I.fillId!=null)D=I.fillId}}safe_format(x,y,D,c);f[p.r]=x}}}}();function write_ws_xml_data(e,r,t,a){var n=[],l=[],i=safe_decode_range(e["!ref"]),s,f,c="",o=[],u,d;for(d=i.s.c;d<=i.e.c;++d)o[d]=encode_col(d);for(u=i.s.r;u<=i.e.r;++u){l=[];c=encode_row(u);for(d=i.s.c;d<=i.e.c;++d){f=o[d]+c;if(e[f]===undefined)continue;if((s=write_ws_xml_cell(e[f],f,e,r,t,a))!=null)l.push(s)}if(l.length>0)n[n.length]=writextag("row",l.join(""),{r:c})}return n.join("")}var WS_XML_ROOT=writextag("worksheet",null,{xmlns:XMLNS.main[0],"xmlns:r":XMLNS.r});function write_ws_xml(e,r,t){var a=[XML_HEADER,WS_XML_ROOT];var n=t.SheetNames[e],l=0,i="";var s=t.Sheets[n];if(s===undefined)s={};var f=s["!ref"];if(f===undefined)f="A1";a[a.length]=writextag("dimension",null,{ref:f});var c=[];if(s["!freeze"]){var o="";o=writextag("pane",null,s["!freeze"]);c.push(o);var u=writextag("selection",null,{pane:"topLeft"});c.push(u);var u=writextag("selection",null,{pane:"bottomLeft"});c.push(u);var u=writextag("selection",null,{pane:"bottomRight",activeCell:s["!freeze"],sqref:s["!freeze"]});c.push(u)}var d=writextag("sheetView",c.join("")||undefined,{showGridLines:r.showGridLines==false?"0":"1",tabSelected:r.tabSelected===undefined?"0":r.tabSelected,workbookViewId:r.workbookViewId===undefined?"0":r.workbookViewId});a[a.length]=writextag("sheetViews",d);if(s["!cols"]!==undefined&&s["!cols"].length>0)a[a.length]=write_ws_xml_cols(s,s["!cols"]);a[l=a.length]="<sheetData/>";if(s["!ref"]!==undefined){i=write_ws_xml_data(s,r,e,t);if(i.length>0)a[a.length]=i}if(a.length>l+1){a[a.length]="</sheetData>";a[l]=a[l].replace("/>",">")}if(s["!merges"]!==undefined&&s["!merges"].length>0)a[a.length]=write_ws_xml_merges(s["!merges"]);if(s["!pageSetup"]!==undefined)a[a.length]=write_ws_xml_pagesetup(s["!pageSetup"]);if(s["!rowBreaks"]!==undefined)a[a.length]=write_ws_xml_row_breaks(s["!rowBreaks"]);if(s["!colBreaks"]!==undefined)a[a.length]=write_ws_xml_col_breaks(s["!colBreaks"]);if(a.length>2){a[a.length]="</worksheet>";a[1]=a[1].replace("/>",">")}return a.join("")}function write_ws_xml_row_breaks(e){var r=[];for(var t=0;t<e.length;t++){var a=""+e[t];var n=""+(e[t+1]||"16383");r.push(writextag("brk",null,{id:a,max:n,man:"1"}))}return writextag("rowBreaks",r.join(" "),{count:r.length,manualBreakCount:r.length})}function write_ws_xml_col_breaks(e){var r=[];for(var t=0;t<e.length;t++){var a=""+e[t];var n=""+(e[t+1]||"1048575");r.push(writextag("brk",null,{id:a,max:n,man:"1"}))}return writextag("colBreaks",r.join(" "),{count:r.length,manualBreakCount:r.length})}