function parse_BrtRowHdr(e,r){var a=[];a.r=e.read_shift(4);e.l+=r-4;return a}var parse_BrtWsDim=parse_UncheckedRfX;var write_BrtWsDim=write_UncheckedRfX;function parse_BrtWsProp(e,r){var a={};e.l+=19;a.name=parse_XLSBCodeName(e,r-19);return a}function parse_BrtCellBlank(e,r){var a=parse_XLSBCell(e);return[a]}function write_BrtCellBlank(e,r,a){if(a==null)a=new_buf(8);return write_XLSBCell(r,a)}function parse_BrtCellBool(e,r){var a=parse_XLSBCell(e);var t=e.read_shift(1);return[a,t,"b"]}function parse_BrtCellError(e,r){var a=parse_XLSBCell(e);var t=e.read_shift(1);return[a,t,"e"]}function parse_BrtCellIsst(e,r){var a=parse_XLSBCell(e);var t=e.read_shift(4);return[a,t,"s"]}function parse_BrtCellReal(e,r){var a=parse_XLSBCell(e);var t=parse_Xnum(e);return[a,t,"n"]}function parse_BrtCellRk(e,r){var a=parse_XLSBCell(e);var t=parse_RkNumber(e);return[a,t,"n"]}function parse_BrtCellSt(e,r){var a=parse_XLSBCell(e);var t=parse_XLWideString(e);return[a,t,"str"]}function parse_BrtFmlaBool(e,r,a){var t=parse_XLSBCell(e);var s=e.read_shift(1);var c=[t,s,"b"];if(a.cellFormula){var l=parse_XLSBCellParsedFormula(e,r-9);c[3]=""}else e.l+=r-9;return c}function parse_BrtFmlaError(e,r,a){var t=parse_XLSBCell(e);var s=e.read_shift(1);var c=[t,s,"e"];if(a.cellFormula){var l=parse_XLSBCellParsedFormula(e,r-9);c[3]=""}else e.l+=r-9;return c}function parse_BrtFmlaNum(e,r,a){var t=parse_XLSBCell(e);var s=parse_Xnum(e);var c=[t,s,"n"];if(a.cellFormula){var l=parse_XLSBCellParsedFormula(e,r-16);c[3]=""}else e.l+=r-16;return c}function parse_BrtFmlaString(e,r,a){var t=e.l;var s=parse_XLSBCell(e);var c=parse_XLWideString(e);var l=[s,c,"str"];if(a.cellFormula){var n=parse_XLSBCellParsedFormula(e,t+r-e.l)}else e.l=t+r;return l}var parse_BrtMergeCell=parse_UncheckedRfX;function parse_BrtHLink(e,r,a){var t=e.l+r;var s=parse_UncheckedRfX(e,16);var c=parse_XLNullableWideString(e);var l=parse_XLWideString(e);var n=parse_XLWideString(e);var B=parse_XLWideString(e);e.l=t;return{rfx:s,relId:c,loc:l,tooltip:n,display:B}}function parse_ws_bin(e,r,a){if(!e)return e;if(!a)a={"!id":{}};var t={};var s;var c={s:{r:1e6,c:1e6},e:{r:0,c:0}};var l=false,n=false;var B,i,o,k,b,f,d,_;var g=[];recordhopper(e,function e(k,u){if(n)return;switch(u.n){case"BrtWsDim":s=k;break;case"BrtRowHdr":B=k;if(r.sheetRows&&r.sheetRows<=B.r)n=true;_=encode_row(B.r);break;case"BrtFmlaBool":case"BrtFmlaError":case"BrtFmlaNum":case"BrtFmlaString":case"BrtCellBool":case"BrtCellError":case"BrtCellIsst":case"BrtCellReal":case"BrtCellRk":case"BrtCellSt":i={t:k[2]};switch(k[2]){case"n":i.v=k[1];break;case"s":d=strs[k[1]];i.v=d.t;i.r=d.r;break;case"b":i.v=k[1]?true:false;break;case"e":i.v=k[1];i.w=BErr[i.v];break;case"str":i.t="s";i.v=utf8read(k[1]);break}if(r.cellFormula&&k.length>3)i.f=k[3];if(o=styles.CellXf[k[0].iStyleRef])safe_format(i,o.ifmt,null,r);t[encode_col(b=k[0].c)+_]=i;if(c.s.r>B.r)c.s.r=B.r;if(c.s.c>b)c.s.c=b;if(c.e.r<B.r)c.e.r=B.r;if(c.e.c<b)c.e.c=b;break;case"BrtCellBlank":if(!r.sheetStubs)break;i={t:"s",v:undefined};t[encode_col(b=k[0].c)+_]=i;if(c.s.r>B.r)c.s.r=B.r;if(c.s.c>b)c.s.c=b;if(c.e.r<B.r)c.e.r=B.r;if(c.e.c<b)c.e.c=b;break;case"BrtBeginMergeCells":break;case"BrtEndMergeCells":break;case"BrtMergeCell":g.push(k);break;case"BrtHLink":var C=a["!id"][k.relId];if(C){k.Target=C.Target;if(k.loc)k.Target+="#"+k.loc;k.Rel=C}for(u=k.rfx.s.r;u<=k.rfx.e.r;++u)for(b=k.rfx.s.c;b<=k.rfx.e.c;++b){f=encode_cell({c:b,r:u});if(!t[f])t[f]={t:"s",v:undefined};t[f].l=k}break;case"BrtArrFmla":break;case"BrtShrFmla":break;case"BrtBeginSheet":break;case"BrtWsProp":break;case"BrtSheetCalcProp":break;case"BrtBeginWsViews":break;case"BrtBeginWsView":break;case"BrtPane":break;case"BrtSel":break;case"BrtEndWsView":break;case"BrtEndWsViews":break;case"BrtACBegin":break;case"BrtRwDescent":break;case"BrtACEnd":break;case"BrtWsFmtInfoEx14":break;case"BrtWsFmtInfo":break;case"BrtBeginColInfos":break;case"BrtColInfo":break;case"BrtEndColInfos":break;case"BrtBeginSheetData":break;case"BrtEndSheetData":break;case"BrtSheetProtection":break;case"BrtPrintOptions":break;case"BrtMargins":break;case"BrtPageSetup":break;case"BrtFRTBegin":l=true;break;case"BrtFRTEnd":l=false;break;case"BrtEndSheet":break;case"BrtDrawing":break;case"BrtLegacyDrawing":break;case"BrtLegacyDrawingHF":break;case"BrtPhoneticInfo":break;case"BrtBeginHeaderFooter":break;case"BrtEndHeaderFooter":break;case"BrtBrk":break;case"BrtBeginRwBrk":break;case"BrtEndRwBrk":break;case"BrtBeginColBrk":break;case"BrtEndColBrk":break;case"BrtBeginUserShViews":break;case"BrtBeginUserShView":break;case"BrtEndUserShView":break;case"BrtEndUserShViews":break;case"BrtBkHim":break;case"BrtBeginOleObjects":break;case"BrtOleObject":break;case"BrtEndOleObjects":break;case"BrtBeginListParts":break;case"BrtListPart":break;case"BrtEndListParts":break;case"BrtBeginSortState":break;case"BrtBeginSortCond":break;case"BrtEndSortCond":break;case"BrtEndSortState":break;case"BrtBeginConditionalFormatting":break;case"BrtEndConditionalFormatting":break;case"BrtBeginCFRule":break;case"BrtEndCFRule":break;case"BrtBeginDVals":break;case"BrtDVal":break;case"BrtEndDVals":break;case"BrtRangeProtection":break;case"BrtBeginDCon":break;case"BrtEndDCon":break;case"BrtBeginDRefs":break;case"BrtDRef":break;case"BrtEndDRefs":break;case"BrtBeginActiveXControls":break;case"BrtActiveX":break;case"BrtEndActiveXControls":break;case"BrtBeginAFilter":break;case"BrtEndAFilter":break;case"BrtBeginFilterColumn":break;case"BrtBeginFilters":break;case"BrtFilter":break;case"BrtEndFilters":break;case"BrtEndFilterColumn":break;case"BrtDynamicFilter":break;case"BrtTop10Filter":break;case"BrtBeginCustomFilters":break;case"BrtCustomFilter":break;case"BrtEndCustomFilters":break;case"BrtBeginSmartTags":break;case"BrtBeginCellSmartTags":break;case"BrtBeginCellSmartTag":break;case"BrtCellSmartTagProperty":break;case"BrtEndCellSmartTag":break;case"BrtEndCellSmartTags":break;case"BrtEndSmartTags":break;case"BrtBeginCellWatches":break;case"BrtCellWatch":break;case"BrtEndCellWatches":break;case"BrtTable":break;case"BrtBeginCellIgnoreECs":break;case"BrtCellIgnoreEC":break;case"BrtEndCellIgnoreECs":break;default:if(!l||r.WTF)throw new Error("Unexpected record "+u.n)}},r);if(!t["!ref"]&&(c.s.r<1e6||s.e.r>0||s.e.c>0||s.s.r>0||s.s.c>0))t["!ref"]=encode_range(s);if(r.sheetRows&&t["!ref"]){var u=safe_decode_range(t["!ref"]);if(r.sheetRows<+u.e.r){u.e.r=r.sheetRows-1;if(u.e.r>c.e.r)u.e.r=c.e.r;if(u.e.r<u.s.r)u.s.r=u.e.r;if(u.e.c>c.e.c)u.e.c=c.e.c;if(u.e.c<u.s.c)u.s.c=u.e.c;t["!fullref"]=t["!ref"];t["!ref"]=encode_range(u)}}if(g.length>0)t["!merges"]=g;return t}function write_ws_bin_cell(e,r,a,t,s){if(r.v===undefined)return"";var c="";switch(r.t){case"b":c=r.v?"1":"0";break;case"n":case"e":c=""+r.v;break;default:c=r.v;break}var l={r:a,c:t};l.s=get_cell_style(s.cellXfs,r,s);switch(r.t){case"s":case"str":if(s.bookSST){c=get_sst_id(s.Strings,r.v);l.t="s";break}l.t="str";break;case"n":break;case"b":l.t="b";break;case"e":l.t="e";break}write_record(e,"BrtCellBlank",write_BrtCellBlank(r,l))}function write_CELLTABLE(e,r,a,t,s){var c=safe_decode_range(r["!ref"]||"A1"),l,n="",B=[];write_record(e,"BrtBeginSheetData");for(var i=c.s.r;i<=c.e.r;++i){n=encode_row(i);for(var o=c.s.c;o<=c.e.c;++o){if(i===c.s.r)B[o]=encode_col(o);l=B[o]+n;if(!r[l])continue;write_ws_bin_cell(e,r[l],i,o,t)}}write_record(e,"BrtEndSheetData")}function write_ws_bin(e,r,a){var t=buf_array();var s=a.SheetNames[e],c=a.Sheets[s]||{};var l=safe_decode_range(c["!ref"]||"A1");write_record(t,"BrtBeginSheet");write_record(t,"BrtWsDim",write_BrtWsDim(l));write_CELLTABLE(t,c,e,r,a);write_record(t,"BrtEndSheet");return t.end()}