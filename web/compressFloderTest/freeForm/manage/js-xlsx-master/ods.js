var ODS={};(function e(r){var a=function(){if(typeof XLSX!=="undefined")return XLSX.utils;if(typeof module!=="undefined"&&typeof require!=="undefined")try{return require("../"+"xlsx").utils}catch(e){try{return require("./"+"xlsx").utils}catch(e){return require("xl"+"sx").utils}}throw new Error("Cannot find XLSX utils")};var t=typeof Buffer!=="undefined";function n(e){var r="";for(var a=0;a!=e.length;++a)r+=String.fromCharCode(e[a]);return r}function s(e){if(!e)return null;if(e.data)return e.data;if(e.asNodeBuffer&&t)return e.asNodeBuffer().toString("binary");if(e.asBinary)return e.asBinary();if(e._data&&e._data.getContent)return n(Array.prototype.slice.call(e._data.getContent(),0));return null}function i(e,r){var a=r;if(e.files[a])return e.files[a];a=r.toLowerCase();if(e.files[a])return e.files[a];a=a.replace(/\//g,"\\");if(e.files[a])return e.files[a];return null}function c(e,r){var a=i(e,r);if(a==null)throw new Error("Cannot find file "+r+" in zip");return a}function o(e,r,a){if(!a)return s(c(e,r));if(!r)return null;try{return o(e,r)}catch(e){return null}}var u,f;if(typeof JSZip!=="undefined")f=JSZip;if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){if(t&&typeof f==="undefined")f=require("js"+"zip");if(typeof f==="undefined")f=require("./js"+"zip").JSZip;u=require("f"+"s")}}var l=/\b[\w:-]+=["'][^"]*['"]/g;var d=/<[^>]*>/g;var p=/<\w*:/,b=/<(\/?)\w+:/;function h(e,r){var a=[];var t=0,n=0;for(;t!==e.length;++t)if((n=e.charCodeAt(t))===32||n===10||n===13)break;if(!r)a[0]=e.substr(0,t);if(t===e.length)return a;var s=e.match(l),i=0,c="",o="",u=0,f="",d="";if(s)for(u=0;u!=s.length;++u){d=s[u];for(n=0;n!=d.length;++n)if(d.charCodeAt(n)===61)break;f=d.substr(0,n);o=d.substring(n+2,d.length-1);for(i=0;i!=f.length;++i)if(f.charCodeAt(i)===58)break;if(i===f.length)a[f]=o;else a[(i===5&&f.substr(0,5)==="xmlns"?"xmlns":"")+f.substr(i+1)]=o}return a}function m(e){return e.replace(b,"<$1")}var v={"&quot;":'"',"&apos;":"'","&gt;":">","&lt;":"<","&amp;":"&"};var k={'"':"&quot;","'":"&apos;",">":"&gt;","<":"&lt;","&":"&amp;"};var g="&<>'\"".split("");var y=/&[a-z]*;/g,w=/_x([\da-fA-F]+)_/g;function x(e){var r=e+"";return r.replace(y,function(e){return v[e]}).replace(w,function(e,r){return String.fromCharCode(parseInt(r,16))})}var C=/[&<>'"]/g,S=/[\u0000-\u0008\u000b-\u001f]/g;function A(e){var r=e+"";return r.replace(C,function(e){return k[e]}).replace(S,function(e){return"_x"+("000"+e.charCodeAt(0).toString(16)).substr(-4)+"_"})}function q(e,r){switch(e){case"1":case"true":case"TRUE":return true;default:return false}}function B(e){var r=Date.parse(e);return(r+22091616e5)/(24*60*60*1e3)}function D(e){var r=0,a=0,t=false;var n=e.match(/P([0-9\.]+Y)?([0-9\.]+M)?([0-9\.]+D)?T([0-9\.]+H)?([0-9\.]+M)?([0-9\.]+S)?/);if(!n)throw new Error("|"+e+"| is not an ISO8601 Duration");for(var s=1;s!=n.length;++s){if(!n[s])continue;a=1;if(s>3)t=true;switch(n[s].substr(n[s].length-1)){case"Y":throw new Error("Unsupported ISO Duration Field: "+n[s].substr(n[s].length-1));case"D":a*=24;case"H":a*=60;case"M":if(!t)throw new Error("Unsupported ISO Duration Field: M");else a*=60;case"S":break}r+=a*parseInt(n[s],10)}return r}function E(e){if(t&&Buffer.isBuffer(e))return e.toString("utf8");if(typeof e==="string")return e;throw"badf"}var _=/<(\/?)([a-z0-9]*:|)([\w-]+)[^>]*>/gm;var I="application/vnd.oasis.opendocument.spreadsheet";var F=function(e,r){var a=E(e);var t;var n;while(t=_.exec(a))switch(t[3]){case"manifest":break;case"file-entry":n=h(t[0]);if(n.path=="/"&&n.type!==I)throw new Error("This OpenDocument is not a spreadsheet");break;case"encryption-data":case"algorithm":case"start-key-generation":case"key-derivation":throw new Error("Unsupported ODS Encryption");default:throw t}};var O=function(e,r){return z(e.replace(/<text:s\/>/g," ").replace(/<[^>]*>/g,""))};var z=function e(r){var a="",t=0,n=0,s=0,i=0,c=0,o=0;while(t<r.length){n=r.charCodeAt(t++);if(n<128){a+=String.fromCharCode(n);continue}s=r.charCodeAt(t++);if(n>191&&n<224){a+=String.fromCharCode((n&31)<<6|s&63);continue}i=r.charCodeAt(t++);if(n<240){a+=String.fromCharCode((n&15)<<12|(s&63)<<6|i&63);continue}c=r.charCodeAt(t++);o=((n&7)<<18|(s&63)<<12|(i&63)<<6|c&63)-65536;a+=String.fromCharCode(55296+(o>>>10&1023));a+=String.fromCharCode(56320+(o&1023))}return a};var M=function(){var e={day:["d","dd"],month:["m","mm"],year:["y","yy"],hours:["h","hh"],minutes:["m","mm"],seconds:["s","ss"],"am-pm":["A/P","AM/PM"],"day-of-week":["ddd","dddd"]};return function r(t,n){var s=E(t);var i=[],c;var o;var u,f,l;var d;var p={},b=[],m={};var v,k;var g;var y,w,x;var C,S,A={s:{r:1e6,c:1e7},e:{r:0,c:0}};var I={};var F=[],z={},M=0,X=0;while(v=_.exec(s))switch(v[3]){case"table":if(v[1]==="/"){if(A.e.c>=A.s.c&&A.e.r>=A.s.r)m["!ref"]=a().encode_range(A);if(F.length)m["!merges"]=F;b.push(d.name);p[d.name]=m}else if(v[0].charAt(v[0].length-2)!=="/"){d=h(v[0]);C=S=-1;A.s.r=A.s.c=1e7;A.e.r=A.e.c=0;m={};F=[]}break;case"table-row":if(v[1]==="/")break;++C;S=-1;break;case"covered-table-cell":++S;break;case"table-cell":if(v[0].charAt(v[0].length-2)==="/"){g=h(v[0]);if(g["number-columns-repeated"])S+=parseInt(g["number-columns-repeated"],10);else++S}else if(v[1]!=="/"){++S;if(S>A.e.c)A.e.c=S;if(C>A.e.r)A.e.r=C;if(S<A.s.c)A.s.c=S;if(C<A.s.r)A.s.r=C;g=h(v[0]);k={t:g["value-type"],v:null};if(g["number-columns-spanned"]||g["number-rows-spanned"]){M=parseInt(g["number-rows-spanned"],10)||0;X=parseInt(g["number-columns-spanned"],10)||0;z={s:{r:C,c:S},e:{r:C+M-1,c:S+X-1}};F.push(z)}switch(k.t){case"boolean":k.t="b";k.v=q(g["boolean-value"]);break;case"float":k.t="n";k.v=parseFloat(g.value);break;case"percentage":k.t="n";k.v=parseFloat(g.value);break;case"currency":k.t="n";k.v=parseFloat(g.value);break;case"date":k.t="n";k.v=B(g["date-value"]);k.z="m/d/yy";break;case"time":k.t="n";k.v=D(g["time-value"])/86400;break;case"string":k.t="s";break;default:throw new Error("Unsupported value type "+k.t)}}else{if(k.t==="s")k.v=y;if(y)k.w=y;if(!(n.sheetRows&&n.sheetRows<C))m[a().encode_cell({r:C,c:S})]=k;k=null}break;case"document-content":case"spreadsheet":case"scripts":case"font-face-decls":if(v[1]==="/"){if((c=i.pop())[0]!==v[3])throw"Bad state: "+c}else if(v[0].charAt(v[0].length-2)!=="/")i.push([v[3],true]);break;case"shapes":case"frame":if(v[1]==="/"){if((c=i.pop())[0]!==v[3])throw"Bad state: "+c}else if(v[0].charAt(v[0].length-2)!=="/")i.push([v[3],false]);break;case"number-style":case"percentage-style":case"date-style":case"time-style":if(v[1]==="/"){I[u.name]=f;if((c=i.pop())[0]!==v[3])throw"Bad state: "+c}else if(v[0].charAt(v[0].length-2)!=="/"){f="";u=h(v[0]);i.push([v[3],true])}break;case"script":break;case"automatic-styles":break;case"style":break;case"font-face":break;case"paragraph-properties":break;case"table-properties":break;case"table-column-properties":break;case"table-row-properties":break;case"table-cell-properties":break;case"number":switch(i[i.length-1][0]){case"time-style":case"date-style":o=h(v[0]);f+=e[v[3]][o.style==="long"?1:0];break}break;case"day":case"month":case"year":case"era":case"day-of-week":case"week-of-year":case"quarter":case"hours":case"minutes":case"seconds":case"am-pm":switch(i[i.length-1][0]){case"time-style":case"date-style":o=h(v[0]);f+=e[v[3]][o.style==="long"?1:0];break}break;case"boolean-style":break;case"boolean":break;case"text-style":break;case"text":if(v[0].substr(-2)==="/>")break;else if(v[1]==="/")switch(i[i.length-1][0]){case"number-style":case"date-style":case"time-style":f+=s.slice(l,v.index);break}else l=v.index+v[0].length;break;case"text-content":break;case"text-properties":break;case"body":break;case"forms":break;case"table-column":break;case"graphic-properties":break;case"calculation-settings":break;case"named-expressions":break;case"named-range":break;case"span":break;case"p":if(v[1]==="/")y=O(s.slice(w,v.index),x);else{x=h(v[0]);w=v.index+v[0].length}break;case"s":break;case"date":break;case"annotation":break;case"object":break;case"title":break;case"desc":break;case"database-ranges":break;case"database-range":break;case"filter":break;case"filter-and":break;case"filter-or":break;case"filter-condition":break;default:if(n.WTF)throw v}var U={Sheets:p,SheetNames:b};return U}}();var X=function(e,r){return M(o(e,"content.xml"),r)};r.parse_ods=X})(typeof exports!=="undefined"?exports:ODS);