var sourceObj={};var typeCode=getTypeCode();var dataSource=getDataSource();window.onload=function(){YCDCommon.loading("on_load")};function on_load(){registerParent()}function registerParent(){window.vm=new Vue({el:"#fastbuild",data:{tableColumObj:{FORM:[{prop:"type",label:"控件类型",editor:"el-select",code:"typeCode",group:true,show:true,foreign:"TYPE",relationship:"relationship_type"},{prop:"ds_ctrlname",label:"控件名",editor:"el-input",foreign:"FIELD_NAMECN",show:true},{prop:"ds_labeltxt",label:"标签名",editor:"el-input",foreign:"FIELD_NAMECN",show:true},{prop:"ds_placeholder",label:"描述",editor:"el-input",foreign:"FIELD_NAMECN",show:true},{prop:"ds_width",label:"宽度",editor:"el-input",default:"100%",show:true},{prop:"ds_datasource",label:"数据源",editor:"el-select",code:"dataSource",show:true},{prop:"ds_name",label:"字段名",editor:"el-select",code:"fieldCode",visible:"getField",foreign:"FIELD_NAME",show:true},{prop:"ds_isrequired",label:"是否必填",editor:"el-switch",align:"center",default:true,foreign:"ALLOWNULL",relationship:"relationship_ds_isrequired",show:true},{prop:"ds_show",label:"是否显示",editor:"el-switch",align:"center",default:true,foreign:"TYPE",relationship:"relationship_ds_show",show:true},{prop:"UUID",label:"UUID",show:false}],FIELDS:[{prop:"FIELD_NAME",label:"字段名",show:true},{prop:"FIELD_NAMECN",label:"字段中文名",show:true},{prop:"ALLOWNULL",label:"是否必填",show:false},{prop:"TYPE",label:"显示控件",show:false}]},leftTableData:[],rightTableData:[],leftCurrRowIndex:"",leftCurrColField:"",leftCurrRow:{},rightCurrRow:{},dataSource:"",globalWidth:"",codeJson:{typeCode:typeCode,dataSource:dataSource,fieldCode:[]}},created:function(){},computed:{},watch:{},methods:{commonFunction:$DS.util.commonFunction,sure:sure,close:$DS.util.close,addData:addData,delData:delData,move:move,selectionLeftChange:selectionLeftChange,selectionRightChange:selectionRightChange,loseInputFcous:loseInputFcous,leftRowClassName:leftRowClassName,rightRowClassName:rightRowClassName,cellClick:cellClick,clickLeftGridRow:clickLeftGridRow,clickRightGridRow:clickRightGridRow,selectLeftRow:selectLeftRow,selectRightRow:selectRightRow,onAfterEdit:onAfterEdit,selectChange:selectChange,stateFormat:stateFormat,changeRightTableData:changeRightTableData,endEditing:endEditing,rightToLeft:rightToLeft,setWidth:setWidth,relationship_type:relationship_type,relationship_ds_isrequired:relationship_ds_isrequired,relationship_ds_show:relationship_ds_show}})}function setWidth(){debugger;var e=this.leftTableData;var t=this.globalWidth;console.log(e);if(t===""){this.$message("请输入要设置的宽度值")}else if(e.length==0){this.$message("请选择字段信息")}for(var r in e){e[r].ds_width=t}}function rightToLeft(){var e=this.rightCurrRow;var t=this.tableColumObj.FORM;for(var r=0;r<e.length;r++){var i={ds_datasource:this.dataSource};for(var o=0;o<t.length;o++){if(t[o].default){i[t[o].prop]=t[o].default}if(t[o].prop=="UUID"){i[t[o].prop]=$DS.util.UUID()}if(t[o].foreign)i[t[o].prop]=t[o].relationship?this[t[o].relationship](e[r][t[o].foreign],e[r]):e[r][t[o].foreign]}this.leftTableData.push(i)}}function addData(){this.endEditing();var e={};for(var t=0;t<this.tableColumObj.FORM.length;t++){e[this.tableColumObj.FORM[t].prop]=this.tableColumObj.FORM[t].default===""?"":getDefault(this.tableColumObj.FORM[t].default)}this.leftTableData.push(e)}function delData(){this.endEditing();var e=this.leftCurrRow;var t=this.leftTableData;if(e){for(var r=0;r<t.length;r++){if(t[r].UUID==e.UUID){t.splice(r,1)}}this.leftTableData=t;this.leftCurrRow={}}else{alert("请选择一行!")}}function move(e){this.endEditing();var t=this.leftCurrRow;var r=this.leftTableData;var i=[];if(t){var o=t.index;o=e=="top"?o-1:o+1;if(o>this.leftTableData.length-1||o<0)return;for(var a=0;a<r.length;a++){if(r[a].index==t.index)continue;if(o==a){if(e=="top"){i.push(t);i.push(r[a])}else{i.push(r[a]);i.push(t)}continue}i.push(r[a])}this.leftTableData=i}else{alert("请选择一行!")}}function sure(){$DS.util.confirm(this,"该操作将清空所有画布元素,重新构建表单,是否继续?",function(e){parent.fastBuildForm(e.leftTableData);e.close()},"已取消该操作!")}function relationship_type(e,t){switch(e){case"input":case"fixedInput":case"hidden":return"drag_input";break;case"tree":return"drag_poptree";break;case"file":return"drag_upload";break;case"htmlEditor":return"drag_rich";break;case"button":case"a":return"drag_button";break;case"radio":case"checkbox":case"textarea":case"select":case"switch":case"date":case"password":return"drag_"+e;break;default:if(e=="fieldset"){alert("【"+t.FIELD_NAMECN+"】分组字段暂时没有控件支持,请使用容器手动布局!");return""}if(e=="none"){alert("注意:【"+t.FIELD_NAMECN+"】字段在表单中设置为不显示,但在表单中引用!");return""}return"";break}}function relationship_ds_isrequired(e){return!e||e=="0"?true:false}function relationship_ds_show(e){return e=="hidden"?false:true}function changeRightTableData(){var e=[];var t=this.dataSource;var r=sourceObj[t];var i=r.fieldInfo;var o=this.tableColumObj.FIELDS;for(var a in i){var l={UUID:$DS.util.UUID()};for(var n=0;n<o.length;n++){l[o[n].prop]=i[a][o[n].prop]}e.push(l)}this.rightTableData=e}function selectionLeftChange(e){}function selectionRightChange(e){this.rightCurrRow=e}function loseInputFcous(e,t){debugger;e.row.seen=false;this.leftCurrRowIndex=-1;this.leftCurrColField="";var r=e.column.columnKey;var i=e.row[r];e["val"]=i;var o={};o[r]=i;this.onAfterEdit(this,e.row,o)}function leftRowClassName({row:e,rowIndex:t}){e.index=t}function rightRowClassName({row:e,rowIndex:t}){e.index=t}function cellClick(e,t,r,i){this.leftCurrColField=t.columnKey;e.seen=true;this.$nextTick(function(){$(r).find("input").focus();$(r).find("input").keydown(function(t){var i=t.which;if(i==13){$(r).find("input").blur();e.seen=false}})})}function clickLeftGridRow(e){if(this.leftCurrRow.seen){this.leftCurrRow.seen=false}this.getIndex=e.index;this.leftCurrRowIndex=e.index;this.leftCurrRow=e}function clickRightGridRow(e){this.getIndex=e.index}function selectLeftRow(e,t){}function selectRightRow(e,t){}function onAfterEdit(e,t,r){}function selectChange(e){var t={};this.leftCurrRow.seen=true;t[this.leftCurrColField]=e;if(this.leftCurrRow.seen){this.leftCurrRow.seen=false;this.leftCurrRowIndex=-1;this.leftCurrColField=""}this.onAfterEdit(this,this.leftCurrRow,t)}function endEditing(){if(this.leftCurrRow.seen){this.leftCurrRow.seen=false;this.leftCurrRowIndex=-1;this.leftCurrColField=""}}function getDefault(value){try{return eval(value)}catch(e){return value}}function stateFormat(e,t){if(t.code&&t.editor=="el-select"){var r=this.$data.codeJson[t.code];if(t.group){for(var i=0;i<r.length;i++){var o=r[i].options;for(var a=0;a<o.length;a++){if(o[a].value==e){return o[a].label}}}}else{for(var l=0;l<r.length;l++){if(r[l].value==e){return r[l].label}}}}return e}function getTypeCode(){var e={};var t=parent.getAllCtrl();for(var r=0;r<t.length;r++){if(t[r].label.trim()=="布局型组件"){t.splice(r,1);continue}for(var i=0;i<t[r].options.length;i++){if(e[t[r].options[i].value]){t[r].options.splice(i,1)}}}return t}function getDataSource(){var e=[];var t=parent.VUECFG.sourceArr;for(var r=0;r<t.length;r++){sourceObj[t[r].sourceId]=t[r];e.push({label:t[r].sourceName,value:t[r].sourceId})}return e}function getField(e){var t=e.vue.$data.leftCurrRow;if(t&&t.ds_datasource){var r=[];var i=sourceObj[t.ds_datasource];var o=i.fieldInfo;for(key in o){r.push({label:o[key].FIELD_NAMECN,value:key})}e.vue.$data.codeJson.fieldCode=r}else{e.vue.$data.codeJson.fieldCode=[]}}