var $FREEFORM="FREEFORM";getAllUrlParams();getUserParams();setPageTitle();window.onload=function(){$DS.loadingFun("on_load",null,getUrlWin(),true)};function on_load(){debugger;if($DS.pageParams["URL_VUECFG"]){VUECFG=window.top[$DS.pageParams["URL_VUECFG"]]}else if($DS.pageParams["URL_VUECFGURL"]){var e=$DS.pageParams["URL_VUECFGURL"].replaceAll("!","../").replaceAll("#","/");$.ajaxSettings.async=false;$.getJSON(e,function(e){debugger;VUECFG=e});$.ajaxSettings.async=true}else if(parent&&parent.$VIEWPDF){VUECFG.appId=$DS.getPms("URL_APPID")}else{initVueCfg()}if(VUECFG.appArr&&VUECFG.appArr.length>0)VUEAPP=VUECFG.appArr;VUECFG.viewStatu=true;loadHomeCssFile();$DS.loadPageCssFile(VUECFG.pageArr);loadComponentsJs();$DS.loadPageCss(VUECFG.pageId);$DS.loadPubJs(VUECFG.pageArr);$DS.loadJs(VUECFG.pageId);$DS.reloadDataSourceFieldInfo();var a=setInterval(function(){if(allJsLoad()){registerForm();registerParent();$DS.initCtrl();$DS.refForm();$DS.refFieldRef();clearDrag();getUrlWin().$DS.loading(false);window.clearInterval(a);allLoadSuceess()}},100)}function initVueCfg(){var e=null;if($DS.getPms("URL_SID")){e=window.top[$DS.getPms("URL_SID")];try{e=JSON.parse(cfgJson)}catch(e){alert("解析配置信息JSON异常,请检查JSON格式是否正确!");console.error(e);return false}}else{var a="FORMID,FORMCONFIG";var r="AND FORMID='"+pageId+"'";var s=$DS.select($DS.getPms("URL_APPID"),a,"DM_FORM_PAGESDETAIL",r,"系统配置信息查询异常");if(s.isError){alert(s.errMsg);return false}else{s=s.result;pageStatus="edit";if(s&&s.FORMCONFIG){e=JSON.parse(s.FORMCONFIG);e.pageInfoId=s.GUID}}}if(e){for(var t in e){VUECFG[t]=e[t]}}VUECFG.pageId=pageId;VUECFG.pageName=pageName}function allLoadSuceess(){temporary.allLoadEvent=$DS.getPageProValByName("ds_page_allloadsuccess");var allLoadInterVal=setInterval(function(){if(!temporary.allLoadEvent)window.clearInterval(allLoadInterVal);if($DS.isAllLoaded()){if($DS.getPms("URL_$VIEWPDF")||$DS.getPms("URL_$REPLACEPDF")){window.$PDF.randerPage({params:""})}eval(temporary.allLoadEvent);window.clearInterval(allLoadInterVal)}},500)}function clearDrag(){$(".ds_ctrl[draggable='true']").attr("draggable","false")}function loadComponentsJs(){debugger;var e=VUECFG.formObj;for(var a in e){var r=$DS.getCtrlType(a);isLoadEchartsBaseJs(e[a].info);if(r=="button"&&!temporary.isLoadXlsxJs){isLoadXlsxJS(e[a].info)}else if(r=="grid"&&!temporary.isLoadSortable){isLoadSortableJS(e[a].info)}temporary.jsObj[r]=r}for(var s in temporary.jsObj){var t=`js/components/${s}.js`;if(s=="map")loadJsForMap();$DS.loadJsByUrl(t,s)}if(parent&&parent.$VIEWPDF||$DS.getPms("URL_$VIEWPDF")||$DS.getPms("URL_$REPLACEPDF")){initPdfJs()}}function isLoadEchartsBaseJs(e){if(e.ds_isEchart===true&&!temporary.isLoadEchartsBaseJs){$DS.loadJsByUrl(`js/components/echarsBaseConfig.js`,"echarsBaseConfig");$DS.loadJsByUrl(`js/components/echarsBaseModel.js`,"echarsBaseModel");$DS.loadJsByUrl(`js/components/echartsBaseProperty.js`,"echartsBaseProperty");temporary["isLoadEchartsBaseJs"]=true}}function loadJsForMap(){$DS.loadJsByUrl(`echarts/provincemap.js`,"provincemap");$DS.loadJsByUrl(`echarts/citymap.js`,"citymap");$DS.loadJsByUrl(`echarts/areamap.js`,"areamap")}function isLoadXlsxJS(e){if(e.ds_button_pubfn=="TableExport"||e.ds_button_pubfn=="ReportExportExcel"||e.ds_button_pubfn=="ExcelImport"||e.ds_button_pubfn=="CustomImportExcel"){var a={fileSaver:"manage/FileSaver.js-master/src/FileSaver.js",xlsx_extendscript:"manage/js-xlsx-master/dist/xlsx.extendscript.js",xlsx_full:"manage/js-xlsx-master/dist/xlsx.full.min.js"};for(var r in a){$DS.loadJsByUrl(a[r],r)}temporary["isLoadXlsxJs"]=true}}function isLoadSortableJS(e){if(e.ds_grid_drop_allowDrop==true){$DS.loadJsByUrl("manage/Sortable/Sortable.min.js","Sortable");temporary["isLoadSortable"]=true}}function allJsLoad(){for(var e in temporary.jsObj){if(!window["$"+e])return false}return true}function loadHomeCssFile(){if(window.top.$SKIN){var e=window.top.$SKIN.CSSPATHOBJ;for(var a in e){var r=document.createElement("link");r.rel="stylesheet";r.href=e[a];document.getElementsByTagName("head")[0].appendChild(r)}}}function initPdfJs(){debugger;var e=`${getProjectName()}/pdfDesigner/js/pdf_form.js`;$DS.loadJsByUrl(e,"form_pdf");$DS.loadJsByUrl(`${getProjectName()}/freeForm/js/components/echarsBaseConfig.js`,"echarsBaseConfig");$DS.loadJsByUrl(`${getProjectName()}/freeForm/js/components/echarsBaseModel.js`,"echarsBaseModel");$DS.loadJsByUrl(`${getProjectName()}/freeForm/js/components/echartsBaseProperty.js`,"echartsBaseProperty");var a=["label","input","textarea","inputnumber","pie"];for(let e of a){var r=`js/components/${e}.js`;$DS.loadJsByUrl(r,e);$DS.util.setObjVal(temporary,["$register",e],e)}var s=setInterval(function(){if(temporary.$register&&Object.keys(temporary.$register).length>0){for(var e in temporary.$register){if(window[`$${e}`]){window[`$${e}`].register();delete temporary.$register[e]}}}else{window.clearInterval(s)}})}