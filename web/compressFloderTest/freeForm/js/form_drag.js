function drag(r){this.options={dragArea:"dragArea",dropArea:"dropArea"};var e={dragArea:null,dropArea:null};var t={index:-1,deraction:0,flag:-1};var o;var n=function(){F(arguments);if(!a(options.dragArea)){e.dragArea=l(options.dragArea);$(e.dragArea).each(function(){if(this.children.length>0)for(var r=0;r<this.children.length;r++){this.children[r].setAttribute("draggable","true");this.children[r].addEventListener("dragstart",g);this.children[r].addEventListener("dragend",m)}})}else{i("请设置拖拽区域")}if(!a(options.dropArea)){e.dropArea=d(options.dropArea);e.dropArea.addEventListener("drop",A);e.dropArea.addEventListener("dragover",v)}else{i("请设置存取地址")}};var a=function(r){if(r==undefined||r==null||r=="")return true;return false};var i=function(r){console.log("dragErr:"+r);throw new Error(r)};var d=function(r){var e=document.getElementById(r);if(a(e))throw new Error("无法找到这个id");return e};var l=function(r){var e=$("."+r);if(e.length==0)throw new Error("无法找到这个class");return e};var f=function(r,e){var t=e.parentNode;if(t.lastChild==e){t.appendChild(r)}else{t.insertBefore(r,e.nextSibling)}};var s=function(r,e){e.parentNode.insertBefore(r,e)};var c=function(){if(e.dropArea.children.length>0)for(var r=0;r<e.dropArea.children.length;r++){e.dropArea.children[r].style.borderBottom="";e.dropArea.children[r].style.borderTop=""}};var u=function(r,e){return r.currentStyle?r.currentStyle[e]:document.defaultView.getComputedStyle(r,false)[e]};var p=function(r){r.preventDefault()};var h=function(r){r.preventDefault();if(t.flag==2){if($($(o)[0].offsetParent).attr("draggable")=="false")return false;if($($(o)[0].offsetParent).attr("dgAble")=="false")return false;o.parentNode.removeChild(o);VUECFG.proId=null;VUECFG.proType=null;VUECFG.ctrlType=null;VUECFG.ctrlId=$(o)[0].id;refearchFormPro();deleteCtrl();VUECFG.ctrlId=null;c()}};var g=function(r){o=r.target;VUECFG.lastTarget=o;if($($(o)[0].offsetParent).attr("draggable")=="false")return false;if($($(o)[0].offsetParent).attr("dgAble")=="false")return false;if($(o.parentNode).attr("dragAble")=="true"){t.flag=1}else if(VUECFG.formObj[o.id]&&VUECFG.formObj[o.id].inRow){t.flag=1}else{t.flag=2;$(e.dragArea).each(function(){this.addEventListener("dragover",p)})}};window.dragStart=g;var v=function(r){r.preventDefault();if($($(o)[0].offsetParent).attr("dgAble")=="false")return false;var n=getPageLocation();var a=-1;if(e.dropArea.children.length>0){for(var i=0;i<e.dropArea.children.length;i++){var d=e.dropArea.children[i].getBoundingClientRect();if(n.y>=d.bottom)continue;a=i;break}if(a==-1){a=e.dropArea.children.length-1}}else{a=0;t["deraction"]=0;t["index"]=-1;t["flag"]=1;return}if(a!=-1){var d=e.dropArea.children[a].getBoundingClientRect();c();if((d.bottom+d.top)/2>n.y){t["deraction"]=-1;t["index"]=a;e.dropArea.children[a].style.borderTop="1px solid blue"}else{t["deraction"]=1;t["index"]=a;e.dropArea.children[a].style.borderBottom="1px solid blue"}}else{t["deraction"]=0;t["index"]=-1}};var m=function(r){if(!$(o)[0]||$($(o)[0].offsetParent).attr("dgAble")=="false")return false;c();$(e.dragArea).each(function(){this.removeEventListener("dragover",p)})};window.dragEnd=m;var A=function(r){r.preventDefault();if($($(o)[0].offsetParent).attr("draggable")=="false")return false;VUECFG.ctrlId=$(o)[0].id;VUECFG.ctrlType=$(o).attr("ctrltype");if(!$(o).attr("ispro")){$(".ds_ctrl").find(".ds-form-item").removeClass("ds_ctrl_active");$(o).find(".ds-form-item").addClass("ds_ctrl_active")}if(t.index!=-1){var n=t.index;if(t.deraction>0){var a;var i=true;if(t.flag==1){if(VUECFG.formObj[o.id]&&VUECFG.formObj[o.id].inRow){getRowSort(VUECFG.formObj[o.id].inRow,o.id,true);VUECFG.formObj[o.id].inRow=null;getFormSort(e.dropArea.children);VUECFG.sort.splice(t.index+1,0,o.id);refearchFormArr()}else{a=getVueTempNode(o);VUECFG.sort.push(a);VUECFG.formObj[a].info.ds_show="y-hide";refearchFormArr()}i=false}else{a=o}if(i){f(a,e.dropArea.children[n]);getFormSort(e.dropArea.children);refearchFormArr()}else{var d=setInterval(function(){if($("#"+a)&&$("#"+a)[0]){f($("#"+a)[0],e.dropArea.children[n]);getFormSort(e.dropArea.children);VUECFG.formObj[a].info.ds_show="y-show";refearchFormArr();window.clearInterval(d)}},10)}}else if(t.deraction<0){var a;var i=true;if(t.flag==1){if(VUECFG.formObj[o.id]&&VUECFG.formObj[o.id].inRow){getRowSort(VUECFG.formObj[o.id].inRow,o.id,true);VUECFG.formObj[o.id].inRow=null;getFormSort(e.dropArea.children);VUECFG.sort.splice(t.index,0,o.id);refearchFormArr()}else{a=getVueTempNode(o);VUECFG.sort.push(a);VUECFG.formObj[a].info.ds_show="y-hide";refearchFormArr()}i=false}else{a=o}if(i){s(a,e.dropArea.children[n]);getFormSort(e.dropArea.children);refearchFormArr()}else{var l=setInterval(function(){if($("#"+a)&&$("#"+a)[0]){s($("#"+a)[0],e.dropArea.children[n]);getFormSort(e.dropArea.children);VUECFG.formObj[a].info.ds_show="y-show";refearchFormArr();window.clearInterval(l)}},10)}}}else if(t.flag==1){if(VUECFG.formObj[o.id]&&VUECFG.formObj[o.id].inRow){getRowSort(VUECFG.formObj[o.id].inRow,o.id,true);VUECFG.formObj[o.id].inRow=null;getFormSort(e.dropArea.children);VUECFG.sort.push(o.id);refearchFormArr()}else{var a=getVueTempNode(o);getFormSort(e.dropArea.children);VUECFG.sort.push(a);refearchFormArr()}}t.index=-1};var F=function(r){for(var e in r)if(!options.hasOwnProperty(e)||options.hasOwnProperty(e)&&options[e]!=r[e])options[e]=r[e]};if(arguments.length>1)arguments=arguments[0];n.apply(this,arguments)}var getPageLocation=function(r){var e=r||window.event;var t=document.documentElement.scrollLeft||document.body.scrollLeft;var o=document.documentElement.scrollTop||document.body.scrollTop;var n=e.pageX||e.clientX+t;var a=e.pageY||e.clientY+o;return{x:n,y:a}};