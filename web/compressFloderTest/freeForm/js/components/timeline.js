var $timeline={type:"drag_timeline",dataType:"allData",uuid:Date.parse(new Date),getConfig:getTimelineConfig,register:registerTimeline,showProperty:showPropertyTimeline,setData:setTimelineVal,getData:getTimelineVal,buildTimelineCfg:buildTimelineBySource};function getTimelineConfig(){return{ds_id:"",ds_ctrlname:"TIMELINE_"+$timeline.uuid++,ds_show:true,ds_showCondition:"",ds_width:"100%",ds_height:"18rem",ds_style:"drawing-item",ds_loading:"normal",ds_out_padding:"0rem",ds_out_margin:"0rem",ds_datasource:"",ds_ispro:false,ds_pid:"",ds_draggable:"true",ds_timeline_data:[],ds_timeline_timestampField:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据",ds_timeline_typeField:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据; 注:此属性会被节点颜色属性覆盖 \n//primary  蓝色\n"+"//success 绿色\n"+"//warning 黄色\n"+"//danger  红色\n"+"//info    灰色",ds_timeline_colorField:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据",ds_timeline_iconField:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据 例:el-icon-check;el-icon-close;el-input__icon el-icon-wind-power",ds_timeline_sizeField:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据 尺寸:normal / large",ds_timeline_placement:"bottom",ds_timeline_hide_timestamp:false,ds_timeline_showModel:true,ds_timeline_left:"5%",ds_timeline_top:"",ds_timeline_cfgModel:[{content:"文本1",timestamp:"2016-04-04 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"},{content:"文本2",timestamp:"2017-04-05 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"},{content:"文本3",timestamp:"2018-04-05 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"},{content:"文本4",timestamp:"2019-04-07 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"}],ds_load_success:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//trigger:是否触发控件刷新",ds_before_loadData:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称}//val:{val:数据,cache:缓存}"}}function registerTimeline(){Vue.component("drag_timeline",{props:["type","info"],created:function(){this.$nextTick(function(){addListener(this);if(!this.info.ds_ispro)temporary.loadRegister[this.info.ds_id]=true;VUECFG.$refs[this.info.ds_id]=this})},data:function(){return{hide:"y-hide",refdate:Date.parse(new Date)}},computed:{computed_drag:function(){if(VUECFG.viewStatu)return false;return this.info.ds_draggable},computed_style:function(){var e={border:"0px",overflow:"auto"};if(!VUECFG.viewStatu){e["height"]="calc(100% - 0rem)"}return e},computed_show:function(){var refdateStr=`${this.refdate}_change`;if(!VUECFG.viewStatu){return this.info.ds_ispro&&!this.info.ds_show?"y-hide":"y-show"}else{if(this.info.ds_showCondition){var str=$DS.util.replace(this.info.ds_showCondition);return eval(str)?"y-show":"y-hide"}return this.info.ds_show?"y-show":"y-hide"}},computed_Ts:function(){if(!VUECFG.viewStatu){return{height:"0rem"}}},computed_outerstyle:function(){var e={width:"100%","margin-left":"0rem",padding:this.info.ds_out_padding,margin:this.info.ds_out_margin};return e},computed_position:function(){return{position:"absolute",left:this.info.ds_timeline_left,top:this.info.ds_timeline_top}},computed_timelineName:function(){if(!VUECFG.viewStatu)return this.info.ds_ctrlname;return""},computed_timeline:function(){var e=[];var d=[];if(this.info.ds_timeline_cfgModel&&this.info.ds_timeline_cfgModel.length>0){var t=this.info.ds_timeline_cfgModel;if(t&&t.length>0){for(var s=0;s<t.length;s++){e.push({timestamp:t[s].timestamp,hide_timestamp:t[s].hide_timestamp==""?false:true,placement:t[s].placement,type:t[s].type,color:t[s].color,size:t[s].size,icon:t[s].icon,content:$DS.util.replace(t[s].content)})}}}if(this.info.ds_timeline_data&&this.info.ds_timeline_data.length>0&&t){var i=this.info.ds_timeline_timestampField;var l=this.info.ds_timeline_typeField;var o=this.info.ds_timeline_colorField;var r=this.info.ds_timeline_iconField;var a=this.info.ds_timeline_sizeField;d=buildTimelineBySource(this.info,this.info.ds_timeline_data,t,i,l,o,r,a)}if(this.info.ds_timeline_showModel){return e.concat(d)}return d}},methods:{changeCurrId:changeCurrId,mouseOver:ctrlMouseOver,mouseLeave:ctrlMouseLeave,computed_content:computed_content},template:util.getModelHtml("drag_timeline")})}function computed_content(e){var d=$DS.util.replace(e.content?e.content:"",e);return d}function loadSuccess(e,d){var t=this.info;$DS.eval(t.ds_load_success,t)}function showPropertyTimeline(e){var d=[];var t=getProInfoByObj("select",{ds_id:"type",ds_pid:VUECFG.ctrlId,ds_labeltxt:"组件类型",ds_placeholder:"组件类型",ds_style:"ds-mt-1",ds_draggable:"false",ds_group:true,ds_options:getAllCtrl(),ds_select:$progress.type,ds_select_change:"changeFormCtrl",ds_name:"type",ds_ispro:true});d.push(t);var s=getProInfoByObj("input",{ds_id:"ds_ctrlname",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件名",ds_placeholder:"控件名",ds_input:VUECFG.formObj[VUECFG.ctrlId].info.ds_ctrlname,ds_input_blur:"checkDuplication",ds_name:"ds_ctrlname",ds_ispro:true});d.push(s);var i=getProInfoByObj("input",{ds_id:"ds_height",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件高度",ds_placeholder:"控件高度",ds_input:"18rem",ds_name:"ds_height",ds_ispro:true});d.push(i);var l=getProInfoByObj("input",{ds_id:"ds_width",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件宽度",ds_placeholder:"控件宽度",ds_input:"100%",ds_name:"ds_width",ds_ispro:true,ds_isrequired:false});d.push(l);var o=getProInfoByObj("input",{ds_id:"ds_timeline_cfgModel",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"时间线配置",ds_placeholder:"时间线配置",ds_input:[{content:"文本1",timestamp:"2016-04-04 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"},{content:"文本2",timestamp:"2017-04-05 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"},{content:"文本3",timestamp:"2018-04-05 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"},{content:"文本4",timestamp:"2019-04-07 00:00:00",hide_timestamp:false,placement:"bottom",type:"primary",color:"#0bbd87",size:"normal",icon:"el-icon-more"}],ds_name:"ds_timeline_cfgModel",ds_readonly:true,ds_input_focus:"timelineCfg",ds_valformat:"JSON",ds_ispro:true});d.push(o);var r=getProInfoByObj("select",{ds_id:"ds_datasource",ds_pid:VUECFG.ctrlId,ds_labeltxt:"数据源",ds_placeholder:"数据源",ds_style:"ds-mt-1",ds_draggable:"false",ds_options:getAllDatasource(),ds_select:"",ds_select_change:"changeDataSourceForCtrl",ds_select_visible_change:"changeDatasourceOption",ds_name:"ds_datasource",ds_ispro:true,group1:"数据源",group2:""});d.push(r);var a=getProInfoByObj("jseditor",{ds_id:"ds_timeline_timestampField",ds_pid:VUECFG.ctrlId,ds_labeltxt:"时间戳配置",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据",ds_prepend:"fn(obj,val){",ds_jseditor_change:"",ds_name:"ds_timeline_timestampField",ds_ispro:true,ds_savedb:false,group1:"数据构建",group2:""});d.push(a);var n=getProInfoByObj("jseditor",{ds_id:"ds_timeline_typeField",ds_pid:VUECFG.ctrlId,ds_labeltxt:"节点类型配置",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据; 注:此属性会被节点颜色属性覆盖  \n//primary  蓝色\n"+"//success 绿色\n"+"//warning 黄色\n"+"//danger  红色\n"+"//info    灰色",ds_prepend:"fn(obj,val){",ds_jseditor_change:"",ds_name:"ds_timeline_typeField",ds_ispro:true,ds_savedb:false,group1:"数据构建",group2:""});d.push(n);var _=getProInfoByObj("jseditor",{ds_id:"ds_timeline_colorField",ds_pid:VUECFG.ctrlId,ds_labeltxt:"节点颜色配置",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据",ds_prepend:"fn(obj,val){",ds_jseditor_change:"",ds_name:"ds_timeline_colorField",ds_ispro:true,ds_savedb:false,group1:"数据构建",group2:""});d.push(_);var p=getProInfoByObj("jseditor",{ds_id:"ds_timeline_iconField",ds_pid:VUECFG.ctrlId,ds_labeltxt:"节点图标配置",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据 例:el-icon-check;el-icon-close;el-input__icon el-icon-wind-power",ds_prepend:"fn(obj,val){",ds_jseditor_change:"",ds_name:"ds_timeline_iconField",ds_ispro:true,ds_savedb:false,group1:"数据构建",group2:""});d.push(p);var m=getProInfoByObj("jseditor",{ds_id:"ds_timeline_sizeField",ds_pid:VUECFG.ctrlId,ds_labeltxt:"节点尺寸配置",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//val 节点数据 尺寸:normal / large",ds_prepend:"fn(obj,val){",ds_jseditor_change:"",ds_name:"ds_timeline_sizeField",ds_ispro:true,ds_savedb:false,group1:"数据构建",group2:""});d.push(m);var c=getProInfoByObj("input",{ds_id:"ds_out_padding",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"内边距大小",ds_placeholder:"内边距大小",ds_input:"0rem",ds_name:"ds_out_padding",ds_ispro:true,group1:"属性",group2:"组件布局"});d.push(c);var u=getProInfoByObj("input",{ds_id:"ds_out_margin",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"外边距大小",ds_placeholder:"外边距大小",ds_input:"0rem",ds_name:"ds_out_margin",ds_ispro:true,group1:"属性",group2:"组件布局"});d.push(u);var g=getProInfoByObj("input",{ds_id:"ds_timeline_left",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"距左",ds_placeholder:"",ds_input:"10%",ds_name:"ds_timeline_left",ds_ispro:true,group1:"属性",group2:"组件布局"});d.push(g);var f=getProInfoByObj("input",{ds_id:"ds_timeline_top",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"距上",ds_placeholder:"",ds_input:"",ds_name:"ds_timeline_top",ds_ispro:true,group1:"属性",group2:"组件布局"});d.push(f);var h=getProInfoByObj("switch",{ds_id:"ds_timeline_showModel",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示模板",ds_name:"ds_timeline_showModel",ds_switch:true,ds_ispro:true,group1:"属性",group2:"组件属性"});d.push(h);var b=getProInfoByObj("switch",{ds_id:"ds_timeline_hide_timestamp",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"是否隐藏时间戳",ds_name:"ds_timeline_hide_timestamp",ds_switch:false,ds_ispro:true,group1:"属性",group2:"组件属性"});d.push(b);var v=getProInfoByObj("radio",{ds_id:"ds_timeline_placement",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"时间戳位置",ds_name:"ds_timeline_placement",ds_radio:"bottom",ds_options:[{value:"bottom",text:"底部"},{value:"top",text:"顶部"}],ds_radiobtn:true,ds_ispro:true,group1:"属性",group2:"组件属性"});d.push(v);var y=getProInfoByObj("select",{ds_id:"ds_loading",ds_pid:VUECFG.ctrlId,ds_labeltxt:"加载机制",ds_placeholder:"请选择加载机制",ds_style:"ds-mt-1",ds_draggable:"false",ds_group:false,ds_options:[{value:"first",label:"优先加载"},{value:"normal",label:"正常加载"},{value:"lazy",label:"懒加载"}],ds_select:"normal",ds_select_change:"changeCtrlLoading",ds_name:"ds_loading",ds_ispro:true,group1:"控件加载",group2:""});d.push(y);var j=getProInfoByObj("switch",{ds_id:"ds_show",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示控件",ds_name:"ds_show",ds_switch:true,ds_ispro:true,group1:"显示设置",group2:""});d.push(j);var C=getProInfoByObj("input",{ds_id:"ds_showCondition",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示条件",ds_placeholder:"${V.推送参数名.A}=='a'||${V.推送参数名.A}=='b'",ds_input:"",ds_name:"ds_showCondition",ds_ispro:true,group1:"显示设置",group2:""});d.push(C);var F=getProInfoByObj("jseditor",{ds_id:"ds_load_success",ds_pid:VUECFG.ctrlId,ds_labeltxt:"加载完成事件",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//trigger:是否触发控件刷新",ds_prepend:"fn(obj,trigger){",ds_jseditor_change:"",ds_name:"ds_load_success",ds_ispro:true,ds_savedb:false,group1:"事件",group2:""});d.push(F);var I=getProInfoByObj("jseditor",{ds_id:"ds_before_loadData",ds_pid:VUECFG.ctrlId,ds_labeltxt:"加载数据前事件",ds_placeholder:"",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称}//val:{val:数据,cache:缓存}",ds_prepend:"fn(obj,val){",ds_jseditor_change:"",ds_name:"ds_before_loadData",ds_ispro:true,ds_savedb:false,group1:"事件",group2:""});d.push(I);if(VUECFG.proObj[VUECFG.ctrlId]&&!e){var w=VUECFG.proObj[VUECFG.ctrlId];for(var D=0;D<d.length;D++){for(var S=0;S<w.length;S++){if(d[D].info.ds_name==w[S].info.ds_name){var t=d[D].type.split("drag_")[1];d[D].info["ds_"+t]=w[S].info["ds_"+t];if(!$DS.util.isUndefined(w[S].info["ds_show"]))d[D].info["ds_show"]=w[S].info["ds_show"]}}}}VUECFG.proObj[VUECFG.ctrlId]=[];VUECFG.proArr=formatterCtrlProCfg(d);VUECFG.proObj[VUECFG.ctrlId]=d;$("#templetePro").click()}function timelineCfg(e,d){var t=e.ds_input;if(t&&t.length>0){var s=new Base64;for(let e=0;e<t.length;e++){if(t[e].content&&isBase64Code(t[e].content)){t[e].content=s.decode(t[e].content)}}}$DS.openCfgTable([{field:"content",title:"文本内容",width:.165,codeType:"html"},{field:"timestamp",title:"时间戳",width:.165,codeType:"date_datetime"},{field:"type",title:"节点类型",width:.165,codeType:"select",code:[{name:"primary",value:"primary"},{name:"success ",value:"success "},{name:"warning",value:"warning"},{name:"danger",value:"danger"},{name:"info",value:"info"}]},{field:"color",title:"节点颜色",width:.165,codeType:"color"},{field:"icon",title:"节点图标",width:.165,edit:"text",codeType:"icon"},{field:"size",title:"节点尺寸",width:.165,codeType:"select",code:[{name:"正常",value:"normal"},{name:"偏大",value:"large"}]}],t,function(d,t){d=JSON.parse(d);$DS.getCtrlById(e.ds_pid).info.ds_timeline_cfgModel=d;e.ds_input=d},"90%","80%","时间线配置",{id:e.ds_pid})}function isBase64Code(e){var d="^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{4}|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)$";var t=new RegExp(d);return t.test(e)}function setTimelineVal(e,d,t){debugger;var s=$DS.getCtrlById(e);var i=getSourceById(VUECFG.groupObj[e]);if(i){if(!d&&s.info.ds_name&&$DS.getSourceData(i,t)){d=$DS.getSourceData(i,t)}s.info.ds_timeline_data=d.rows}else{s.info.ds_timeline_data=d?d.rows:[]}}function getTimelineVal(e){var d=$DS.getCtrlById(e);if(!d)console.error("【ID为"+e+"】的控件不存在!");return d.info.ds_timeline_data}function buildTimelineBySource(e,d,t,s,i,l,o,r){debugger;var a=t.length;var n=d.map((d,n)=>{var _={};var p=n%a;if(t.length>0){_=$DS.util.clone(t[p])}d["content"]=d.content?d.content:_.content;if(!$DS.eval(s,e,d)||$DS.util.isBoolean($DS.eval(s,e,d)))d["timestamp"]=_["timestamp"];else d["timestamp"]=$DS.eval(s,e,d);if(!$DS.eval(i,e,d)||$DS.util.isBoolean($DS.eval(i,e,d)))d["type"]=_["type"];else d["type"]=$DS.eval(i,e,d);if(!$DS.eval(l,e,d)||$DS.util.isBoolean($DS.eval(l,e,d)))d["color"]=_["color"];else d["color"]=$DS.eval(l,e,d);if(!$DS.eval(o,e,d)||$DS.util.isBoolean($DS.eval(o,e,d)))d["icon"]=_["icon"];else d["icon"]=$DS.eval(o,e,d);if(!$DS.eval(r,e,d)||$DS.util.isBoolean($DS.eval(r,e,d)))d["size"]=_["size"];else d["size"]=$DS.eval(r,e,d);return d});return n}function getTimelineSourceFieldOption(){debugger;var e=[{label:"无",value:""}];if(VUECFG.ctrlId){var d=$DS.getCtrlById(VUECFG.ctrlId).info;if(d.ds_datasource){var t=$DS.getSourceById(d.ds_datasource).columns;if(t){t.map(d=>{var t={};t["label"]=d.FIELD_NAMECN;t["value"]=d.FIELD_NAME;e.push(t)})}}}return e}