var $row={type:"drag_row",dataType:"singeleData",uuid:Date.parse(new Date),getConfig:getRowConfig,register:registerRow,showProperty:showPropertyRow,changeLayout:changeLayout};function getRowConfig(){return{ds_id:"",ds_ctrlname:"ROW_"+$row.uuid++,ds_show:true,ds_showCondition:"",ds_width:"100%",ds_height:"5rem",ds_style:"drawing-item",ds_ispro:false,ds_pid:"",ds_draggable:"true",ds_rowarr:[],ds_deraction:{index:-1,deraction:0,flag:-1},ds_row_background_color:"#ffffff",ds_row_background_image:"",ds_row_background_repeat:"no-repeat",ds_row_background_size:"100% 100%",ds_row_borderwidth:"0",ds_row_borderstyle:"solid",ds_row_border_radius:"0px",ds_row_bordercolor:"#CCC",ds_row_overflow:"auto",ds_row_margin:"0rem",ds_row_padding:"0rem",ds_row_zIndex:1999,ds_row_position:"relative",ds_row_top:"",ds_row_bottom:"",ds_row_left:"",ds_row_right:"",ds_row_isflex:true,ds_row_horizontally:"flex-start",ds_row_vertical:"flex-start",ds_row_centerRow:false,ds_row_layoutRow:false,ds_load_success:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//trigger:是否触发控件刷新"}}function registerRow(){Vue.component("drag_row",{props:["type","info"],created:function(){if(!temporary.layoutRowCfg){temporary.layoutRowCfg={}}if(this.info.ds_row_centerRow){temporary.layoutRowCfg["centerRow"]=this.info.ds_id}else if(this.info.ds_row_layoutRow){temporary.layoutRowCfg[this.info.ds_id]="layoutRow"}this.$nextTick(function(){addListener(this);var r=$(this.$el).find(".el-row")[0].id;$("#"+r)[0].addEventListener("drop",dropRow);$("#"+r)[0].addEventListener("dragover",dragRowOver);if(!this.info.ds_ispro)temporary.loadRegister[this.info.ds_id]=true;VUECFG.$refs[this.info.ds_id]=this})},data:function(){return{hide:"y-hide",refdate:Date.parse(new Date)}},computed:{computed_drag:function(){if(VUECFG.viewStatu)return false;return this.info.ds_draggable},computed_position:function(){var r={zIndex:this.info.ds_row_zIndex,minHeight:this.info.ds_height,height:this.info.ds_height,width:this.info.ds_width,position:this.info.ds_row_position};r["top"]=this.info.ds_row_top;r["bottom"]=this.info.ds_row_bottom;r["left"]=this.info.ds_row_left;r["right"]=this.info.ds_row_right;return r},computed_style:function(){var r={backgroundColor:this.info.ds_row_background_color,backgroundImage:this.info.ds_row_background_image,backgroundRepeat:this.info.ds_row_background_repeat,backgroundSize:this.info.ds_row_background_size,borderColor:this.info.ds_row_bordercolor,borderStyle:this.info.ds_row_borderstyle,borderRadius:this.info.ds_row_border_radius,cursor:"pointer",overflow:this.info.ds_row_overflow,margin:this.info.ds_row_margin,padding:this.info.ds_row_padding};if(!VUECFG.viewStatu){r["height"]="calc(100% - 0rem)"}var e=this.info.ds_row_borderwidth.split(",");var d="";for(let r=0;r<e.length;r++){d+=e[r]+"px "}r["borderWidth"]=d;if(this.info.ds_row_isflex==true){r["display"]="flex";r["webkitDisplay"]="flex";r["margin"]="auto";r["justifyContent"]=this.info.ds_row_horizontally;r["alignItems"]=this.info.ds_row_vertical}return r},computed_show:function(){var refdateStr=`${this.refdate}_change`;if(!VUECFG.viewStatu){return this.info.ds_ispro&&!this.info.ds_show?"y-hide":"y-show"}else{if(this.info.ds_showCondition){var str=$DS.util.replace(this.info.ds_showCondition);return eval(str)?"y-show":"y-hide"}return this.info.ds_show?"y-show":"y-hide"}},computed_rowname:function(){if(!VUECFG.viewStatu)return this.info.ds_ctrlname;return""},computed_Ts:function(){if(!VUECFG.viewStatu){return{height:"0rem"}}}},methods:{changeCurrId:changeCurrId,mouseOver:ctrlMouseOver,mouseLeave:ctrlMouseLeave},template:util.getModelHtml("drag_row")})}function dragRowOver(r){r.preventDefault();if(VUECFG.viewStatu)return false;var e=r.currentTarget.id;e=e.split("_holder")[0];var d=VUECFG.formObj[e];var s=VUECFG.lastTarget;var t=getPageLocation();var o=d.info.ds_deraction;var i=r.currentTarget;var _=-1;if(i.children.length>0){for(var a=0;a<i.children.length;a++){var l=i.children[a].getBoundingClientRect();if(t.y>=l.bottom)continue;_=a;break}}else{_=0;o["deraction"]=0;o["index"]=-1;o["flag"]=1;return}if(_!=-1){var l=i.children[_].getBoundingClientRect();setRowBorderDefault(i);if((l.bottom+l.top)/2>t.y){o["deraction"]=-1;o["index"]=_;i.children[_].style.borderTop="1px solid blue"}else{o["deraction"]=1;o["index"]=_;i.children[_].style.borderBottom="1px solid blue"}}else{o["deraction"]=0;o["index"]=-1}}var setRowBorderDefault=function(r){if(r.children.length>0)for(var e=0;e<r.children.length;e++){r.children[e].style.borderBottom="";r.children[e].style.borderTop=""}};function loadSuccess(r,e){var d=this.info;$DS.eval(d.ds_load_success,d)}function dropRow(r){$DS.util.stopEvent(r);if(VUECFG.viewStatu)return false;var e=r.currentTarget.id;e=e.split("_holder")[0];var d=VUECFG.formObj[e];var s=VUECFG.lastTarget;if(e==s.id)return;if(VUECFG.formObj[s.id]){if(VUECFG.formObj[s.id].inRow){if(VUECFG.formObj[s.id].inRow==d.info.ds_id){VUECFG.formObj[e].info.ds_deraction.flag=1;getRowSort(e,s.id,false)}else{VUECFG.formObj[e].info.ds_deraction.flag=-1;getRowSort(VUECFG.formObj[s.id].inRow,s.id,true);getRowSort(e,s.id,false);VUECFG.formObj[s.id].inRow=d.info.ds_id}}else{getFormSort($("#dropArea")[0].children,s.id);VUECFG.formObj[s.id].inRow=d.info.ds_id;var t=VUECFG.formObj[e].info.ds_deraction.index;d.info.ds_rowarr.splice(t,0,VUECFG.formObj[s.id])}}else{VUECFG.formObj[e].info.ds_deraction.flag=-1;var o=getVueTempNode(s);VUECFG.formObj[o].inRow=d.info.ds_id;getRowSort(e,o,false)}setRowBorderDefault(r.currentTarget);$DS.refForm();$DS.refPro()}function getRowSort(r,e,d){var s=VUECFG.formObj[r].info.ds_rowarr;var t=VUECFG.formObj[r].info.ds_deraction;var o=t.index;var i=t.deraction>0?"bottom":"top";var _=t.flag==-1?"insert":"change";var a=[];if(d){for(var l=0;l<s.length;l++){if(s[l].info.ds_id!=e)a.push(s[l])}}else{if(o==-1&&_=="insert"){VUECFG.formObj[r].info.ds_rowarr.push(VUECFG.formObj[e]);return}else if(o!=-1){for(var l=0;l<s.length;l++){if(_=="change"&&s[l].info.ds_id==e){if(l==o)a.push(VUECFG.formObj[e]);continue}if(l==o&&i=="top")a.push(VUECFG.formObj[e]);a.push(s[l]);if(l==o&&i=="bottom")a.push(VUECFG.formObj[e])}}else if(o==-1&&_=="change"){a=s}}VUECFG.formObj[r].info.ds_rowarr=a;VUECFG.formObj[r].info.ds_deraction={index:-1,deraction:0,flag:-1}}function showPropertyRow(r){var e=[];var d=getProInfoByObj("select",{ds_id:"type",ds_pid:VUECFG.ctrlId,ds_labeltxt:"组件类型",ds_placeholder:"组件类型",ds_style:"ds-mt-1",ds_draggable:"false",ds_group:true,ds_options:getAllCtrl(),ds_select:$row.type,ds_select_change:"changeFormCtrl",ds_name:"type",ds_ispro:true});e.push(d);var s=getProInfoByObj("input",{ds_id:"ds_ctrlname",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件名",ds_placeholder:"控件名",ds_input:VUECFG.formObj[VUECFG.ctrlId].info.ds_ctrlname,ds_input_blur:"checkDuplication",ds_name:"ds_ctrlname",ds_ispro:true});e.push(s);var t=getProInfoByObj("input",{ds_id:"ds_width",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件宽度",ds_placeholder:"控件宽度",ds_input:"100%",ds_name:"ds_width",ds_ispro:true});e.push(t);var o=getProInfoByObj("input",{ds_id:"ds_height",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件高度",ds_placeholder:"控件高度",ds_input:"5rem",ds_name:"ds_height",ds_ispro:true});e.push(o);var i=getProInfoByObj("switch",{ds_id:"ds_row_centerRow",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"是否为中心容器",ds_name:"ds_row_centerRow",ds_switch:false,ds_ispro:true,ds_switch_change:"changeCenterRow",group1:"属性",group2:"组件布局"});e.push(i);var _=getProInfoByObj("switch",{ds_id:"ds_row_layoutRow",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"是否为布局容器",ds_name:"ds_row_layoutRow",ds_switch:false,ds_ispro:true,ds_switch_change:"changeLayoutRow",group1:"属性",group2:"组件布局"});e.push(_);var a=getProInfoByObj("input",{ds_id:"ds_row_padding",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"内边距大小",ds_placeholder:"内边距大小",ds_input:"0rem",ds_name:"ds_row_padding",ds_ispro:true,group1:"属性",group2:"组件布局"});e.push(a);var l=getProInfoByObj("input",{ds_id:"ds_row_margin",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"外边距大小",ds_placeholder:"外边距大小",ds_input:"0rem",ds_name:"ds_row_margin",ds_ispro:true,group1:"属性",group2:"组件布局"});e.push(l);var n=getProInfoByObj("radio",{ds_id:"ds_row_overflow",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"内容溢出处理",ds_name:"ds_row_overflow",ds_radio:"auto",ds_options:[{value:"auto",text:"滚动"},{value:"visible",text:"溢出"},{value:"hidden",text:"隐藏"}],ds_radiobtn:true,ds_ispro:true,group1:"属性",group2:"组件布局"});e.push(n);var u=getProInfoByObj("input",{ds_id:"ds_row_zIndex",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件z-index",ds_placeholder:"控件z-index",ds_input:"1999",ds_name:"ds_row_zIndex",ds_ispro:true,ds_valformat:"NUMBER",group1:"属性",group2:"组件布局"});e.push(u);var f=getProInfoByObj("radio",{ds_id:"ds_row_position",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"定位方式",ds_name:"ds_row_position",ds_radio:"relative",ds_options:[{value:"relative",text:"relative"},{value:"absolute",text:"absolute"},{value:"fixed",text:"fixed"}],ds_radiobtn:true,ds_ispro:true,group1:"属性",group2:"定位"});e.push(f);var g=getProInfoByObj("input",{ds_id:"ds_row_top",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"距上",ds_input:"",ds_name:"ds_row_top",ds_ispro:true,ds_show:true,group1:"属性",group2:"定位"});e.push(g);var p=getProInfoByObj("input",{ds_id:"ds_row_bottom",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"距下",ds_input:"",ds_name:"ds_row_bottom",ds_ispro:true,ds_show:true,group1:"属性",group2:"定位"});e.push(p);var c=getProInfoByObj("input",{ds_id:"ds_row_left",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"距左",ds_input:"",ds_name:"ds_row_left",ds_ispro:true,ds_show:true,group1:"属性",group2:"定位"});e.push(c);var h=getProInfoByObj("input",{ds_id:"ds_row_right",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"距右",ds_input:"",ds_name:"ds_row_right",ds_ispro:true,ds_show:true,group1:"属性",group2:"定位"});e.push(h);var w=getProInfoByObj("switch",{ds_id:"ds_row_isflex",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"开启弹性布局",ds_name:"ds_row_isflex",ds_switch:true,ds_ispro:true,ds_switch_change:"rowIsflexSwitch",group1:"属性",group2:"弹性布局"});e.push(w);var b=getProInfoByObj("select",{ds_id:"ds_row_horizontally",ds_pid:VUECFG.ctrlId,ds_labeltxt:"内部水平排列",ds_placeholder:"",ds_style:"ds-mt-1",ds_draggable:"false",ds_group:false,ds_options:[{value:"flex-start",label:"左对齐"},{value:"flex-end",label:"右对齐"},{value:"center",label:"居中"},{value:"space-between",label:"两端对齐"},{value:"space-around",label:"间距相等"}],ds_select:"flex-start",ds_name:"ds_row_horizontally",ds_ispro:true,ds_show:true,group1:"属性",group2:"弹性布局"});e.push(b);var m=getProInfoByObj("select",{ds_id:"ds_row_vertical",ds_pid:VUECFG.ctrlId,ds_labeltxt:"内部垂直排列",ds_placeholder:"",ds_style:"ds-mt-1",ds_draggable:"false",ds_group:false,ds_options:[{value:"flex-start",label:"上对齐"},{value:"flex-end",label:"下对齐"},{value:"center",label:"居中"}],ds_select:"flex-start",ds_name:"ds_row_vertical",ds_ispro:true,ds_show:true,group1:"属性",group2:"弹性布局"});e.push(m);var y=getProInfoByObj("color",{ds_id:"ds_row_background_color",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"容器背景颜色",ds_name:"ds_row_background_color",ds_ispro:true,ds_show_alpha:true,ds_color:"#ffffff",group1:"属性",group2:"背景"});e.push(y);var v=getProInfoByObj("input",{ds_id:"ds_row_background_image",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"容器背景图片",ds_placeholder:"图片地址",ds_input:"图片地址",ds_name:"ds_row_background_image",ds_ispro:true,ds_input_focus:"setBackgroundImage",group1:"属性",group2:"背景"});e.push(v);var C=getProInfoByObj("input",{ds_id:"ds_row_background_size",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"背景图宽高",ds_placeholder:"100%100%",ds_input:"100% 100%",ds_name:"ds_row_background_size",ds_ispro:true,group1:"属性",group2:"背景"});e.push(C);var R=getProInfoByObj("switch",{ds_id:"ds_row_background_repeat",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"图片是否可重复",ds_name:"ds_row_background_repeat",ds_switch:false,ds_active_value:"repeat",ds_inactive_value:"no-repeat",ds_ispro:true,group1:"属性",group2:"背景"});e.push(R);var I=getProInfoByObj("radio",{ds_id:"ds_row_borderstyle",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"边框类型",ds_name:"ds_row_borderstyle",ds_radio:"solid",ds_options:[{value:"dashed",text:"虚线"},{value:"solid",text:"实线"},{value:"dotted",text:"点"}],ds_radiobtn:true,ds_ispro:true,group1:"属性",group2:"边框"});e.push(I);var E=getProInfoByObj("input",{ds_id:"ds_row_borderwidth",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"容器边框宽度",ds_placeholder:"顺序:上右下左;单位:px",ds_input:"0",ds_name:"ds_row_borderwidth",ds_ispro:true,group1:"属性",group2:"边框"});e.push(E);var V=getProInfoByObj("input",{ds_id:"ds_row_border_radius",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"边框圆角",ds_placeholder:"边框圆角",ds_input:"0px",ds_name:"ds_row_border_radius",ds_ispro:true,group1:"属性",group2:"边框"});e.push(V);var F=getProInfoByObj("color",{ds_id:"ds_row_bordercolor",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"容器边框颜色",ds_name:"ds_row_bordercolor",ds_ispro:true,ds_show_alpha:true,ds_color:"#CCC",group1:"属性",group2:"边框"});e.push(F);var U=getProInfoByObj("switch",{ds_id:"ds_show",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示控件",ds_name:"ds_show",ds_switch:true,ds_ispro:true,group1:"显示设置",group2:""});e.push(U);var x=getProInfoByObj("input",{ds_id:"ds_showCondition",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示条件",ds_placeholder:"${V.推送参数名.A}=='a'||${V.推送参数名.A}=='b'",ds_input:"",ds_name:"ds_showCondition",ds_ispro:true,group1:"显示设置",group2:""});e.push(x);var G=getProInfoByObj("jseditor",{ds_id:"ds_load_success",ds_pid:VUECFG.ctrlId,ds_labeltxt:"加载完成事件",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//trigger:是否触发控件刷新",ds_prepend:"fn(obj,trigger){",ds_jseditor_change:"",ds_name:"ds_load_success",ds_ispro:true,ds_savedb:false,group1:"事件",group2:""});e.push(G);if(VUECFG.proObj[VUECFG.ctrlId]&&!r){var j=VUECFG.proObj[VUECFG.ctrlId];for(var O=0;O<e.length;O++){for(var B=0;B<j.length;B++){if(e[O].info.ds_name==j[B].info.ds_name){var d=e[O].type.split("drag_")[1];e[O].info["ds_"+d]=j[B].info["ds_"+d];if(!$DS.util.isUndefined(j[B].info["ds_show"]))e[O].info["ds_show"]=j[B].info["ds_show"]}}}}VUECFG.proObj[VUECFG.ctrlId]=[];VUECFG.proArr=formatterCtrlProCfg(e);VUECFG.proObj[VUECFG.ctrlId]=e;$("#templetePro").click()}function rowIsflexSwitch(r,e){$DS.setRightProShow(r.ds_pid,{ds_row_horizontally:e,ds_row_vertical:e})}function setBackgroundImage(){showMyDialog("图片库","95%","95%","manage/imageUpLoad/upload.html?ctrlId="+VUECFG.ctrlId+"&ctrlType="+VUECFG.ctrlType+"&basePath="+$DS.util.getProjectName(VUECFG.appId),function(){})}function changeCenterRow(r,e){var d=$DS.getCtrlById(r.ds_pid);if(d.inRow){alert("中心容器必须为顶层容器!");return}if(!temporary["layoutRowCfg"]){temporary["layoutRowCfg"]={}}if(e){if(temporary.layoutRowCfg["centerRow"]){let r=$DS.getCtrlById(temporary.layoutRowCfg["centerRow"]).info;$DS.setPro(r.ds_id,"ds_row_centerRow","switch",false);alert("中心容器已由【"+r.ds_ctrlname+"】切换为【"+d.info.ds_ctrlname+"】")}temporary.layoutRowCfg["centerRow"]=r.ds_pid}else{delete temporary.layoutRowCfg.centerRow}}function changeLayoutRow(r,e){var d=$DS.getCtrlById(r.ds_pid);if(d.inRow){alert("布局容器必须为顶层容器!");return}if(!temporary["layoutRowCfg"]){temporary["layoutRowCfg"]={}}if(d.info.ds_row_centerRow&&e){alert("不允许同时为中心容器和布局容器!");return false}else if(!d.info.ds_row_centerRow&&e){temporary["layoutRowCfg"][d.info.ds_id]="layoutRow"}else{delete temporary["layoutRowCfg"][d.info.ds_id]}}function changeLayout(r){if(!temporary.layoutRowCfg["centerRow"]){console.error(`未设置中心容器!`);return}let e={ctrlNames:[],width:[],height:[],centerRowWidth:"",centerRowHeight:""};let d="";for(var s of r){if(s.ctrlName=="centerRow"){e.centerRowWidth=s.width;e.centerRowHeight=s.height}else{var t=$DS.getCtrl(s.ctrlName).info;if(!temporary.layoutRowCfg[t.ds_id]){console.error(`${s.ctrlName}控件不是布局容器!`);return}e.ctrlNames.push(s.ctrlName);e.width.push(s.width);e.height.push(s.height);d+=t.ds_id}}if(!temporary.layoutRowStatus){temporary.layoutRowStatus={}}let o=temporary.layoutRowStatus[d];changeLayoutByStatus(o,r,e);temporary.layoutRowStatus[d]=!o}function changeLayoutByStatus(r,e,d){let s="+";if(r){s="-"}let t=$DS.getCtrlById(temporary.layoutRowCfg["centerRow"]).info;if(d.centerRowWidth){t.ds_width=`calc(${t.ds_width} ${s} ${d.centerRowWidth})`}if(d.centerRowHeight){t.ds_height=`calc(${t.ds_height} ${s} ${d.centerRowHeight})`}d.ctrlNames.map((r,e)=>{let t=$DS.getCtrl(r).info;if(d.width[e]){t.ds_width=`calc(${t.ds_width} ${s} ${d.width[e]})`}if(d.height[e]){t.ds_height=`calc(${t.ds_height} ${s} ${d.height[e]})`}})}