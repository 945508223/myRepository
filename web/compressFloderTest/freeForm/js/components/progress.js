var $progress={type:"drag_progress",dataType:"singeleData",uuid:Date.parse(new Date),getConfig:getProgressConfig,register:registerProgress,showProperty:showPropertyProgress,setData:setProgressVal,getData:getProgressVal,clearData:clearProgressVal};function getProgressConfig(){return{ds_id:"",ds_ctrlname:"PROGRESS_"+$progress.uuid++,ds_show:true,ds_showCondition:"",ds_width:"100%",ds_height:"5rem",ds_style:"drawing-item",ds_datasource:"",ds_name:"",ds_loading:"normal",ds_out_padding:"0rem",ds_out_margin:"0rem",ds_labeltxt:"进度条",ds_showlable:true,ds_labelwidth:"10",ds_labelcolor:"#606266",ds_labelfontweight:"bold",ds_labelfontfamily:"微软雅黑",ds_labelfontsize:"1",ds_innerwidth:"calc(100% - 2rem)",ds_ispro:false,ds_pid:"",ds_draggable:"true",ds_progress:70,ds_defaultval:"",ds_progress_warning:60,ds_progress_success:80,ds_progress_type:"line",ds_progress_text_inside:true,ds_progress_stroke_width:14,ds_progress_chose_color_type:"singleColor",ds_progress_singleColor:"#409EFF",ds_progress_arrColor:"",ds_progress_width:126,ds_progress_show_text:true,ds_progress_stroke_linecap:"round",ds_progress_format:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称}//val:变更值",ds_load_success:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//trigger:是否触发控件刷新"}}function registerProgress(){Vue.component("drag_progress",{props:["type","info"],created:function(){this.$nextTick(function(){addListener(this);if(!this.info.ds_ispro)temporary.loadRegister[this.info.ds_id]=true;VUECFG.$refs[this.info.ds_id]=this})},data:function(){return{hide:"y-hide",refdate:Date.parse(new Date)}},computed:{computed_drag:function(){if(VUECFG.viewStatu)return false;return this.info.ds_draggable},computed_width:function(){return this.info.ds_showlable?"calc(100% - "+this.info.ds_labelwidth+"rem)":"100%"},computed_show:function(){var refdateStr=`${this.refdate}_change`;if(!VUECFG.viewStatu){if(this.info.ds_showCondition){var str=$DS.util.replace(this.info.ds_showCondition);return eval(str)?"y-show":"y-hide"}return this.info.ds_ispro&&!this.info.ds_show?"y-hide":"y-show"}else{return this.info.ds_show?"y-show":"y-hide"}},computed_marginleft:function(){return this.info.ds_showlable?this.info.ds_labelwidth+"rem":"0rem"},computed_outerstyle:function(){var s={padding:this.info.ds_out_padding,margin:this.info.ds_out_margin};return s},computed_sataus:function(){if(this.info.ds_progress_warning&&this.info.ds_progress<this.info.ds_progress_warning){return"exception"}if(this.info.ds_progress_success&&this.info.ds_progress<this.info.ds_progress_success){return"warning"}return"success"},computed_if:function(){debugger;return!isNaN(parseFloat(this.info.ds_progress))},computed_percentage:function(){debugger;return parseFloat(this.info.ds_progress)},computed_color:function(){switch(this.info.ds_progress_chose_color_type){case"singleColor":return this.info.ds_progress_singleColor;break;case"arrColor":if(typeof this.info.ds_progress_arrColor==="string"&&this.info.ds_progress_arrColor!=""){return JSON.parse(this.info.ds_progress_arrColor)}else if(this.info.ds_progress_arrColor==""){return[this.info.ds_progress_singleColor]}for(let s=0;s<this.info.ds_progress_arrColor.length;s++){try{this.info.ds_progress_arrColor[s].percentage=parseFloat(this.info.ds_progress_arrColor[s].percentage);if(isNaN(this.info.ds_progress_arrColor[s].percentage)){alert("请输入数字!")}}catch(s){console.error(s)}}return this.info.ds_progress_arrColor;break}},computed_labelstyle:function(){return{width:this.info.ds_labelwidth+"rem",color:this.info.ds_labelcolor,fontWeight:!this.info.ds_ispro?this.info.ds_labelfontweight:"normal",fontFamily:this.info.ds_labelfontfamily,fontSize:this.info.ds_labelfontsize}}},methods:{changeCurrId:changeCurrId,mouseOver:ctrlMouseOver,mouseLeave:ctrlMouseLeave,progress_format:progress_format},template:util.getModelHtml("drag_progress")})}function loadSuccess(s,e){var d=this.info;$DS.eval(d.ds_load_success,d)}function progress_format(s){var e=this.info;if(e.ds_progress_format){var d=$DS.eval(e.ds_progress_format,e,s);if(!$DS.util.isBoolean(d)){return d}}return s}function progressTypeChange(s,e){var d=$DS.getCtrlById(s.ds_pid);$DS.setRightProShow(s.ds_pid,{ds_progress_stroke_linecap:e=="line"?false:true})}function changeChoseColorType(s,e){var d=["singleColor","arrColor"];var r={};for(let s=0;s<d.length;s++){if(e===d[s]){r["ds_progress_"+d[s]]=true}else{r["ds_progress_"+d[s]]=false}}$DS.setRightProShow(s.ds_pid,r)}function choseArrColor(s){var e=[{field:"color",title:"颜色",width:.5,codeType:"color"},{edit:"text",field:"percentage",title:"百分比(%)",width:.5}];var d=s.ds_input?s.ds_input:null;if(d&&typeof d==="string"){d=JSON.parse(d)}$DS.openCfgTable(e,d,function(e,d){s.ds_input=e;e=JSON.parse(e);if(e&&e.length>0){var r=[];for(let s=0;s<e.length;s++){for(var t in e[s]){if(t!=="color"&&t!=="percentage"){delete e[s][t]}}r.push(e[s])}}$DS.getCtrlById(s.ds_pid).info.ds_progress_arrColor=r},"60%","80%","设置多组颜色")}function showProgressStatus(s,e){$DS.setRightProShow(s.ds_pid,{ds_progress_warning:e?false:true,ds_progress_success:e?false:true})}function showPropertyProgress(s){var e=[];var d=getProInfoByObj("select",{ds_id:"type",ds_pid:VUECFG.ctrlId,ds_labeltxt:"组件类型",ds_placeholder:"组件类型",ds_style:"ds-mt-1",ds_draggable:"false",ds_group:true,ds_options:getAllCtrl(),ds_select:$progress.type,ds_select_change:"changeFormCtrl",ds_name:"type",ds_ispro:true});e.push(d);var r=getProInfoByObj("input",{ds_id:"ds_ctrlname",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件名",ds_placeholder:"控件名",ds_input:VUECFG.formObj[VUECFG.ctrlId].info.ds_ctrlname,ds_input_blur:"checkDuplication",ds_name:"ds_ctrlname",ds_ispro:true});e.push(r);var t=getProInfoByObj("input",{ds_id:"ds_labeltxt",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"标题",ds_placeholder:"标题",ds_input:"进度条",ds_name:"ds_labeltxt",ds_ispro:true});e.push(t);var o=getProInfoByObj("input",{ds_id:"ds_width",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件宽度",ds_placeholder:"控件宽度",ds_input:"100%",ds_name:"ds_width",ds_ispro:true,ds_isrequired:false});e.push(o);var _=getProInfoByObj("input",{ds_id:"ds_height",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"控件高度",ds_placeholder:"控件高度",ds_input:"5rem",ds_name:"ds_height",ds_ispro:true});e.push(_);var l=getProInfoByObj("input",{ds_id:"ds_progress",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"进度条百分比",ds_placeholder:"进度条百分比",ds_input:70,ds_valformat:"NUMBER",ds_name:"ds_progress",ds_ispro:true});e.push(l);var a=getProInfoByObj("select",{ds_id:"ds_datasource",ds_pid:VUECFG.ctrlId,ds_labeltxt:"数据源",ds_placeholder:"数据源",ds_style:"ds-mt-1",ds_draggable:"false",ds_options:getAllDatasource(),ds_select:"",ds_select_change:"changeDataSourceForCtrl",ds_select_visible_change:"changeDatasourceOption",ds_name:"ds_datasource",ds_ispro:true,group1:"数据源",group2:""});e.push(a);var i=getProInfoByObj("select",{ds_id:"ds_name",ds_pid:VUECFG.ctrlId,ds_labeltxt:"字段名",ds_placeholder:"字段名",ds_style:"ds-mt-1",ds_draggable:"false",ds_options:getAllDatasourceField(),ds_select:"",ds_select_change:"changeFieldNameForCtrl",ds_select_visible_change:"changeFieldOption",ds_name:"ds_name",ds_ispro:true,group1:"数据源",group2:""});e.push(i);var n=getProInfoByObj("input",{ds_id:"ds_innerwidth",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"组件宽度",ds_placeholder:"组件宽度",ds_input:"calc(100% - 2rem)",ds_name:"ds_innerwidth",ds_ispro:true,group1:"属性",group2:"组件布局"});e.push(n);var p=getProInfoByObj("input",{ds_id:"ds_out_padding",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"内边距大小",ds_placeholder:"内边距大小",ds_input:"0rem",ds_name:"ds_out_padding",ds_ispro:true,group1:"属性",group2:"组件布局"});e.push(p);var g=getProInfoByObj("input",{ds_id:"ds_out_margin",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"外边距大小",ds_placeholder:"外边距大小",ds_input:"0rem",ds_name:"ds_out_margin",ds_ispro:true,group1:"属性",group2:"组件布局"});e.push(g);var u=getProInfoByObj("input",{ds_id:"ds_labelwidth",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"标题宽度",ds_placeholder:"标题宽度",ds_input:"10",ds_name:"ds_labelwidth",ds_ispro:true,ds_append:"rem",group1:"属性",group2:"标题样式"});e.push(u);var c=getProInfoByObj("color",{ds_id:"ds_labelcolor",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"标题颜色",ds_name:"ds_labelcolor",ds_ispro:true,ds_show_alpha:true,ds_color:"#606266",group1:"属性",group2:"标题样式"});e.push(c);var f=getProInfoByObj("select",{ds_id:"ds_labelfontweight",ds_pid:VUECFG.ctrlId,ds_labeltxt:"标题字体加粗",ds_placeholder:"标题字体加粗",ds_style:"ds-mt-1",ds_draggable:"false",ds_options:getFontWeight(),ds_select:"bold",ds_name:"ds_labelfontweight",ds_ispro:true,group1:"属性",group2:"标题样式"});e.push(f);var h=getProInfoByObj("select",{ds_id:"ds_labelfontfamily",ds_pid:VUECFG.ctrlId,ds_labeltxt:"标题字体样式",ds_placeholder:"标题字体样式",ds_style:"ds-mt-1",ds_draggable:"false",ds_options:getFontFamily(),ds_select:"微软雅黑",ds_name:"ds_labelfontfamily",ds_ispro:true,group1:"属性",group2:"标题样式"});e.push(h);var b=getProInfoByObj("input",{ds_id:"ds_labelfontsize",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"标题字体大小",ds_placeholder:"标题字体大小",ds_input:"1rem",ds_name:"ds_labelfontsize",ds_ispro:true,ds_isrequired:false,group1:"属性",group2:"标题样式"});e.push(b);let m=getProInfoByObj("input",{ds_id:"ds_progress_stroke_width",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"进度条高度",ds_placeholder:"进度条高度",ds_input:14,ds_name:"ds_progress_stroke_width",ds_ispro:true,ds_valformat:"NUMBER",ds_append:"px",group1:"属性",group2:"组件样式"});e.push(m);let y=getProInfoByObj("radio",{ds_id:"ds_progress_type",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"进度条类型",ds_name:"ds_progress_type",ds_radio:"line",ds_options:[{value:"line",text:"线条"},{value:"circle",text:"环形"},{value:"dashboard",text:"仪表盘"}],ds_radiobtn:true,ds_ispro:true,ds_radio_change:"progressTypeChange",group1:"属性",group2:"组件样式"});e.push(y);var C=getProInfoByObj("radio",{ds_id:"ds_progress_text_inside",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"内容显示位置",ds_name:"ds_progress_text_inside",ds_radio:true,ds_options:[{value:true,text:"内"},{value:false,text:"外"}],ds_radiobtn:true,ds_ispro:true,ds_radio_change:"showProgressStatus",group1:"属性",group2:"组件样式"});e.push(C);var v=getProInfoByObj("input",{ds_id:"ds_progress_warning",ds_pid:VUECFG.ctrlId,ds_labeltxt:"预警状态值",ds_placeholder:"",ds_style:"ds-mt-1",ds_draggable:"false",ds_name:"ds_progress_warning",ds_input:60,ds_ispro:true,ds_show:false,ds_valformat:"NUMBER",group1:"属性",group2:"组件样式"});e.push(v);var w=getProInfoByObj("input",{ds_id:"ds_progress_success",ds_pid:VUECFG.ctrlId,ds_labeltxt:"成功状态值",ds_placeholder:"",ds_style:"ds-mt-1",ds_draggable:"false",ds_name:"ds_progress_success",ds_input:80,ds_ispro:true,ds_show:false,ds_valformat:"NUMBER",group1:"属性",group2:"组件样式"});e.push(w);let I=getProInfoByObj("radio",{ds_id:"ds_progress_stroke_linecap",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"两端形状",ds_name:"ds_progress_stroke_linecap",ds_radio:"round",ds_options:[{value:"butt",text:"butt"},{value:"round",text:"round"},{value:"square",text:"square"}],ds_radiobtn:true,ds_ispro:true,ds_show:false,group1:"属性",group2:"组件样式"});e.push(I);var F=getProInfoByObj("switch",{ds_id:"ds_progress_show_text",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"是否显示内容",ds_name:"ds_progress_show_text",ds_switch:true,ds_ispro:true,group1:"属性",group2:"组件样式"});e.push(F);var V=getProInfoByObj("select",{ds_id:"ds_progress_chose_color_type",ds_pid:VUECFG.ctrlId,ds_labeltxt:"设置颜色方式",ds_placeholder:"",ds_style:"ds-mt-1",ds_draggable:"false",ds_options:[{value:"singleColor",label:"单一颜色"},{value:"arrColor",label:"多种颜色"}],ds_select:"singleColor",ds_name:"ds_progress_chose_color_type",ds_ispro:true,ds_multiple:false,ds_select_change:"changeChoseColorType",group1:"属性",group2:"组件样式"});e.push(V);var P=getProInfoByObj("color",{ds_id:"ds_progress_singleColor",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"进度条背景颜色",ds_placeholder:"进度条背景颜色",ds_color:"#409EFF",ds_show_alpha:true,ds_name:"ds_progress_singleColor",ds_ispro:true,ds_show:true,group1:"属性",group2:"组件样式"});e.push(P);var E=getProInfoByObj("input",{ds_id:"ds_progress_arrColor",ds_pid:VUECFG.ctrlId,ds_labeltxt:"多组颜色",ds_placeholder:"",ds_style:"ds-mt-1",ds_draggable:"false",ds_name:"ds_progress_arrColor",ds_ispro:true,ds_show:false,ds_input_focus:"choseArrColor",ds_valformat:"JSON",group1:"属性",group2:"组件样式"});e.push(E);var x=getProInfoByObj("select",{ds_id:"ds_loading",ds_pid:VUECFG.ctrlId,ds_labeltxt:"加载机制",ds_placeholder:"请选择加载机制",ds_style:"ds-mt-1",ds_draggable:"false",ds_group:false,ds_options:[{value:"first",label:"优先加载"},{value:"normal",label:"正常加载"},{value:"lazy",label:"懒加载"}],ds_select:"normal",ds_select_change:"changeCtrlLoading",ds_name:"ds_loading",ds_ispro:true,group1:"控件加载",group2:""});e.push(x);var U=getProInfoByObj("input",{ds_id:"ds_defaultval",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"缺省值",ds_placeholder:"${V.参数,'缺省值'}",ds_input:"",ds_name:"ds_defaultval",ds_ispro:true,group1:"缺省值",group2:""});e.push(U);var j=getProInfoByObj("switch",{ds_id:"ds_showlable",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示标题",ds_name:"ds_showlable",ds_switch:true,ds_ispro:true,group1:"显示设置",group2:""});e.push(j);var G=getProInfoByObj("switch",{ds_id:"ds_show",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示控件",ds_name:"ds_show",ds_switch:true,ds_ispro:true,group1:"显示设置",group2:""});e.push(G);var O=getProInfoByObj("input",{ds_id:"ds_showCondition",ds_pid:VUECFG.ctrlId,ds_draggable:"false",ds_style:"ds-mt-1",ds_labeltxt:"显示条件",ds_placeholder:"${V.推送参数名.A}=='a'||${V.推送参数名.A}=='b'",ds_input:"",ds_name:"ds_showCondition",ds_ispro:true,group1:"显示设置",group2:""});e.push(O);var B=getProInfoByObj("jseditor",{ds_id:"ds_load_success",ds_pid:VUECFG.ctrlId,ds_labeltxt:"加载完成事件",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称},//trigger:是否触发控件刷新",ds_prepend:"fn(obj,trigger){",ds_jseditor_change:"",ds_name:"ds_load_success",ds_ispro:true,ds_savedb:false,group1:"事件",group2:""});e.push(B);var S=getProInfoByObj("jseditor",{ds_id:"ds_progress_format",ds_pid:VUECFG.ctrlId,ds_labeltxt:"进度条文字内容",ds_placeholder:"脚本",ds_style:"ds-mt-1",ds_draggable:"false",ds_jseditor:"//obj:配置对象{ds_id:组件id,ds_ctrlname:组件名称}//val:变更值",ds_prepend:"fn(obj,val){",ds_jseditor_change:"",ds_name:"ds_progress_format",ds_ispro:true,ds_savedb:false,group1:"事件",group2:""});e.push(S);if(VUECFG.proObj[VUECFG.ctrlId]&&!s){var D=VUECFG.proObj[VUECFG.ctrlId];for(var N=0;N<e.length;N++){for(var k=0;k<D.length;k++){if(e[N].info.ds_name==D[k].info.ds_name){var d=e[N].type.split("drag_")[1];e[N].info["ds_"+d]=D[k].info["ds_"+d];if(!$DS.util.isUndefined(D[k].info["ds_show"]))e[N].info["ds_show"]=D[k].info["ds_show"]}}}}VUECFG.proObj[VUECFG.ctrlId]=[];VUECFG.proArr=formatterCtrlProCfg(e);VUECFG.proObj[VUECFG.ctrlId]=e;$("#templetePro").click()}function setProgressVal(s,e,d){var r=$DS.getCtrlById(s);var t=getSourceById(VUECFG.groupObj[s]);if(t){if(!e&&r.info.ds_name&&$DS.getSourceData(t,d)){e=$DS.getSourceData(t,d)[r.info.ds_name]}r.info.ds_progress=e}else{r.info.ds_progress=e?e:""}}function getProgressVal(s){var e=$DS.getCtrlById(s);if(!e)console.error("【ID为"+s+"】的控件不存在!");return e.info.ds_progress}function clearProgressVal(s){s.info.ds_progress=0}