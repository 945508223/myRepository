class ToXlsx{constructor(e,t,r,s){this.id=e;this.title=t;this.isNotStyle=r;this.fileTitle=s}async createCustomizeTable(){debugger;var e=document.getElementById(this.id);var t=$DS.util.getHtml(this.id);if(this.fileTitle){var r=document.getElementsByName(this.fileTitle).length>0?true:false;if(!r){var s=`<tr  class="" style="color: rgb(0, 0, 0);display: none">\n                        <th colspan="3" rowspan="1" class="el-table_3_column_10_column_11  is-center   is-sortable only-table"\n                            style="background-color: rgb(234, 238, 249); height: 2rem;">\n                            <div class="cell" name=${this.fileTitle}>\n                                <div class="center breakcell">${this.fileTitle}</div>\n                                <span class="caret-wrapper"><i class="sort-caret ascending"></i><i class="sort-caret descending"></i></span>\n                            </div>\n                        </th>\n                        <th class="gutter" style="width: 7px;"></th>\n                    </tr>`;$("thead").prepend(s)}var l=$DS.util.getHtml(this.id)}let a=XLSX2.utils.table_to_sheet(document.querySelector("#"+this.id));var o=e.getElementsByTagName("tr");if(!o||o.length<=0){console.log("表格无数据或格式不正确");return false}var i=parseFloat((document.documentElement.clientWidth||document.body.clientWidth)/114<10?12:(document.documentElement.clientWidth||document.body.clientWidth)/114).toFixed(2);debugger;var n=[];var c=[];var u=true;var g=true;for(let e=0;e<o.length;e++){u=true;var v=o[e].style;var h=o[e].getElementsByTagName("th");var f=true;if(h&&h.length>1){f=true}else{f=false}var d=f?"th":"td";var m=o[e].getElementsByTagName(d);for(let t=0;t<m.length;t++){if(m[t].classList[0]=="gutter")continue;var b;b=parseInt(m[t].classList[0].substring($DS.util.strLength(m[t].classList[0])-1))-t;var p=parseInt(m[t].classList[0].substring($DS.util.strLength(m[t].classList[0])-1))-b;if(u){var y=m[t].style;var B=$(m[t]).css("height")||"3rem";n.push(B);u=false}if(!f&&g){var S=m[t].getElementsByTagName("div")[0];var D=S.style;var w=$(S).css("width")||"10rem";c.push(w)}var y=m[t].style;var E=false;if(m[t].className.indexOf("only-table")!=-1)E=true;var x=RGBA216BS(y["color"]?y["color"]:v["color"]).substring(1);var T=RGBA216BS(y["background-color"]?y["background-color"]:v["background-color"]).substring(1);var N=reverse(reverse(y["font-size"]?y["font-size"]:v["font-size"]).substring(3))*i;var L=y["border-bottom"]?y["border-bottom"]:v["border-bottom"];var k=L.split(" ");var R=k[1];var _=RGBA216BS(k[2]?k[2]:"rgba(225, 225, 225, 0.49)");if(!a[convertDSTo26BS(p+1)+(e+1)])continue;a[convertDSTo26BS(p+1)+(e+1)].s={font:this.isNotStyle?{name:"宋体",sz:E?30:N||12,color:{rgb:x||"000000"},bold:f?true:false,italic:false,underline:false}:"",alignment:this.isNotStyle?{horizontal:f?"center":"left",vertical:"center",wrap_text:true}:"",fill:this.isNotStyle?{fgColor:{rgb:T||"DEDEDE"}}:"",border:this.isNotStyle?{top:{style:R||"medium",color:{rgb:_||"DBDBDB"}},bottom:{style:R||"medium",color:{rgb:_||"DBDBDB"}},left:{style:R||"medium",color:{rgb:_||"DBDBDB"}},right:{style:R||"medium",color:{rgb:_||"DBDBDB"}}}:""};if(!f&&g){if(t==m.length)g=false}}}var A=[];for(let e=0;e<c.length;e++){var F;var f;if(c[e].indexOf("px")!=-1){F=parseFloat(reverse(reverse(c[e]).substring((1,2))));f={wpx:F}}else{F=parseFloat(reverse(reverse(c[e]).substring((1,3))))*i;f={wpx:F}}A.push(f)}var I=[];for(let e=0;e<n.length;e++){var F;var f;if(n[e].indexOf("px")!=-1){F=parseFloat(reverse(reverse(n[e]).substring((1,2))));f={wpx:F}}else{F=parseFloat(reverse(reverse(n[e]).substring((1,3))))*i;f={wpx:F}}I.push(f)}a["!cols"]=A;a["!rows"]=I;try{this.openDownloadDialog(this.sheet2blob(a),this.title)}catch(e){console.log("自定义表格报错",e)}}sheet2blob(e,t){t=t||"sheet1";let r={SheetNames:[t],Sheets:{}};r.Sheets[t]=e;let s={bookType:"xlsx",bookSST:false,type:"binary"};let l=XLSX.write(r,s);let a=new Blob([o(l)],{type:"application/octet-stream"});function o(e){let t=new ArrayBuffer(e.length);let r=new Uint8Array(t);for(let t=0;t!=e.length;++t)r[t]=e.charCodeAt(t)&255;return t}return a}openDownloadDialog(e,t){if(typeof e=="object"&&e instanceof Blob){e=URL.createObjectURL(e)}let r=document.createElement("a");r.href=e;r.download=t||"";let s;if(window.MouseEvent)s=new MouseEvent("click");else{s=document.createEvent("MouseEvents");s.initMouseEvent("click",true,false,window,0,0,0,0,0,false,false,false,false,0,null)}r.dispatchEvent(s)}}function RGBA216BS(e){var t=e.replace(/rgba?\(/,"").replace(/\)/,"").replace(/[\s+]/g,"").split(",");var r=parseFloat(t[3]||1),s=Math.floor(r*parseInt(t[0])+(1-r)*255),l=Math.floor(r*parseInt(t[1])+(1-r)*255),a=Math.floor(r*parseInt(t[2])+(1-r)*255);return"#"+("0"+s.toString(16)).slice(-2)+("0"+l.toString(16)).slice(-2)+("0"+a.toString(16)).slice(-2)}String.prototype.colorHex=function(){var e=/^(rgb|RGB)/;var t=this;if(e.test(t)){var r="#";var s=t.replace(/(?:\(|\)|rgb|RGB)*/g,"").split(",");for(var l=0;l<s.length;l++){var a=Number(s[l]).toString(16);if(a==="0"){a+=a}a=a.length==1?"0"+a:a;r+=a}return r}else{return String(t)}};function reverse(e){if(!e){return""}return e.split("").reverse().join("")}function convertDSTo26BS(e){var t="";var r=/^\d+$/g;if(!r.test(e)){return t}while(e>0){m=e%26;if(m==0){m=26}t=String.fromCharCode(64+parseInt(m))+t;e=(e-m)/26}return t}