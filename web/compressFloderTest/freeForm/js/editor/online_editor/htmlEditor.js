debugger;var id=YCDCommon.Win.getUrlParam("ds_id");var ds_name=YCDCommon.Win.getUrlParam("ds_name");var ispro=YCDCommon.Win.getUrlParam("ispro");var htmlStr=YCDCommon.Win.getUrlParam("htmlStr");var key=YCDCommon.Win.getUrlParam("key");var themeCode="idea";var currid=YCDCommon.Win.getUrlParam("currid");var html_Text=getHtmlText();function getHtmlText(){debugger;try{if(id&&id==="PAGE"){if(parent.VUECFG.pageArr&&parent.VUECFG.pageArr.length>0){var e=parent.VUECFG.pageArr;for(var t=0;t<e.length;t++){if(e[t].info.ds_name==="ds_pagehtml"){themeCode=e[t].info.ds_theme;return e[t].info.ds_htmleditor}}}}else if(id){var r=parent.$DS.getCtrlById(id).info;themeCode=r.ds_theme?r.ds_theme:"idea";return r[ds_name]}else if(htmlStr==="1"&&key){return window.top[key].html}else if(currid){var o=parent.$DS.util.getOuterHtml(currid);var a=parent.$DS.util.htmlFormate(o);return a}}catch(e){console.log("获取HTML失败!");console.log(e)}}let cm_opt={mode:"text/html",gutter:false,lineNumbers:true,autoCloseBrackets:true,styleActiveLine:true,theme:themeCode,lineWrapping:true,foldGutter:true,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],extraKeys:{"Alt-/":"autocomplete"},matchBrackets:true,matchTags:{bothTags:true},autoCloseTags:true};let html_editor=CodeMirror.fromTextArea(document.getElementById("code-html"),cm_opt);if(html_Text){html_editor.setValue(html_Text)}if(currid){$("#toobar").hide();html_editor.setOption("readOnly",true)}$("#sure").bind("click",function(){save_html()});$("#cancle").bind("click",function(){close_()});function save_html(){debugger;var e=html_editor.getValue();if(htmlStr==="1"&&key){window.top[key].callback(e)}else{parent.$DS.setPro(id,ds_name,ispro=="true"?"htmleditor":"input",e)}close_()}function selectTheme(e){html_editor.setOption("theme",e.target.value)}