var temporary={projectName:null,loadRegister:{},firstTriggerObj:{},cacheSourceData:{},compObj:{},jsObj:{},paramsObj:{},menuContrast:{},refObj:{},fieldInfoObj:{},echarsCtrlDM:{}};var pageId=YCDCommon.Win.getUrlParam("PAGEID");var pageName=YCDCommon.Win.getUrlParam("PAGETITLE");var pageStatus="add";var VUEAPP=initAppForPage();var VUECFG={pageId:pageId,pageName:pageName,pageInfoId:"",pageArr:[],viewStatu:false,ctrlId:"",ctrlType:"",sort:[],formObj:{},formArr:[],proId:"",proType:"",proObj:{},proArr:[],appId:"",appArr:[],appObj:{},sourceArr:[],groupObj:{},firstObj:{},normalObj:{},lazyObj:{},$refs:{}};function getSourceObj(){var e={sourceId:"source_"+Date.parse(new Date),sourceName:"数据源_"+Date.parse(new Date),sourceType:"singleData",sourceData:null,sourceGroup:{},appId:VUECFG.appId,tableName:"",tableInfo:VUECFG.appObj[VUECFG.appId],keyField:"",fieldInfo:[],fieldMap:{},columns:"",customcolumns:"",order:"",filter:"",treeId:"GUID",treePid:"",treeName:"",treeStatus:"",treeotherCols:"",sqlFileds:"",sql:"",dbSource:"",dbSourceInfo:[{label:"当前系统",value:""},{label:"平台库",value:"portal"}]};return $DS.util.clone(e)}function registerParent(){window.vm=new Vue({el:"#content",data:{isFirstLoad:true,activeName:"first",pageArr:VUECFG.pageArr,appid:VUECFG.appId,appArr:VUECFG.appArr,sourceArr:VUECFG.sourceArr,form:{},formArr:VUECFG.formArr,proArr:VUECFG.proArr,ctrlBar:"y-hide",proBar:"y-hide",iconHolder:"y-hide",commonIcon:commonIcon,cfgJson:"",pms:"",activeNames:["1"],currentId:VUECFG.ctrlId,selectFormObj:VUECFG.formObj,importCfg:""},created:function(){initApp(this);this.appid=VUECFG.appId;if(!VUECFG.viewStatu)initPage(this);this.$nextTick(function(){this.isFirstLoad=false;if(!VUECFG.viewStatu){$(document).keyup(function(e){keyUpEvent(e)})}})},computed:{computed_view:function(){return VUECFG.viewStatu?"viewClass":"designClass"},computed_style:function(){var e={};for(let t=0;t<this.pageArr.length;t++){var r=this.pageArr[t].info;if(r.ds_name.indexOf("background")!=-1){switch(r.ds_name.split("_")[3]){case"color":e["backgroundColor"]=r.ds_color;break;case"position":e["backgroundPosition"]=r.ds_input;break;case"image":e["backgroundImage"]=r.ds_input;break;case"repeat":if(r.ds_switch!=true){e["backgroundRepeat"]="no-repeat"}else{e["backgroundRepeat"]="repeat"}break;case"size":e["backgroundSize"]=r.ds_input;break}}}return e}},watch:{},methods:{dealform:dealform,dealPagePro:dealPagePro,dealPro:dealPro,dealSource:dealSource,deleteformCtrl:deleteformCtrl,dragTabClick:dragTabClick,addDataSource:addDataSource,commonFunction:commonFunction,closeIcon:closeIcon,commandExec:commandExec,selectCtrl:selectCtrl,buildFormObj:buildFormObj}});$DS.VUE=window.vm}function buildFormObj(){this.selectFormObj={};this.selectFormObj=VUECFG.formObj}function keyUpEvent(e){if(getParentByClass(e.target)&&!getParentByClass(e.target).attr("ispro")||e.target.tagName=="BODY"){switch(e.keyCode){case 46:if(!VUECFG.ctrlId){alert("请选择控件!");return false}$(`#${VUECFG.ctrlId} .drawing-item-delete`).click();break;case e.ctrlKey&&38:if(!VUECFG.ctrlId){alert("请选择控件!");return false}var r=$DS.getCtrlById(VUECFG.ctrlId).inRow;if(r){var t=$DS.getCtrlById(r).info.ds_rowarr;var o=VUECFG.sort;for(let e=0;e<t.length;e++){if(t[e].info.ds_id===VUECFG.ctrlId){if(e===0){alert("控件已在容器顶层");return}swapArray(t,e,e-1);swapArray(o,e,e-1);break}}}else{var a=VUECFG.formArr;var o=VUECFG.sort;for(var i=0;i<a.length;i++){if(a[i].info.ds_id===VUECFG.ctrlId){if(i===0){alert("控件已在画布顶层");return}swapArray(a,i,i-1);swapArray(o,i,i-1);break}}}break;case e.ctrlKey&&40:if(!VUECFG.ctrlId){alert("请选择控件!");return false}var r=$DS.getCtrlById(VUECFG.ctrlId).inRow;if(r){var t=$DS.getCtrlById(r).info.ds_rowarr;var o=VUECFG.sort;for(var i=0;i<t.length;i++){if(t[i].info.ds_id===VUECFG.ctrlId){if(i===t.length-1){alert("控件已在容器底层");return}swapArray(t,i,i+1);swapArray(o,i,i+1);break}}}else{var a=VUECFG.formArr;var o=VUECFG.sort;for(var i=0;i<a.length;i++){if(a[i].info.ds_id===VUECFG.ctrlId){if(i===a.length-1){alert("控件已在画布底层");return}swapArray(a,i,i+1);swapArray(o,i,i+1);break}}}break;case e.ctrlKey&&86:if(!VUECFG.ctrlId){alert("请选择控件!");return false}$(`#${VUECFG.ctrlId} .drawing-item-copy`).click();break}}}function swapArray(e,r,t){e[r]=e.splice(t,1,e[r])[0];return e}function getParentByClass(e,r){$(e).parent().each(function(){if($(this).attr("ctrltype")){r=$(this)}else{r=getParentByClass(this,r)}});return r}function selectCtrl(e){changeCurrId({currentTarget:$(`#${e}`)[0],id:e})}function registerDrag(){Vue.component("drag-btn",{props:["btn_id","btn_text","btn_ctrltype"],template:util.getModelHtml("drag-btn")});Vue.component("drag_classify",{props:["classify_id","classify_text"],template:util.getModelHtml("drag_classify")});Vue.component("drag_able",{props:["dragDatas"],template:util.getModelHtml("drag_able")});Vue.component("drag_list",{data:function(){return{list:componentsCfg}},template:util.getModelHtml("drag_list")})}function registerDataSource(){Vue.component("data-source",{props:["source"],created:function(){},data:function(){return{appArr:VUECFG.appArr}},computed:{computed_appid:{get:function(){return this.source.appId?this.source.appId:VUECFG.appId},set:function(e){debugger;this.source.appId=e}},getSourceDataInfo:getSourceDataInfo,getFildInfo:getFildInfo,computed_columns:getComputedColums},methods:{changeSourceAppId:changeSourceAppId,getSourceTables:getSourceTables,getTableFields:getTableFields,setKeyField:setKeyField,deleteSource:deleteSource,clickTableFields:clickTableFields},template:util.getModelHtml("data-source")})}function registerForm(){for(var e=0;e<componentsCfg.length;e++){var r=componentsCfg[e].dragDatas;for(var t=0;t<r.length;t++){var o=r[t].btn_ctrltype.split("drag_")[1];if(VUECFG.viewStatu&&!temporary.jsObj[o])continue;var a=window["$"+o];if(!a){util.exceptionRegister("$"+o);return false}a.register()}}Vue.component("drag_comp",{props:["data","info"],created:function(){},data:function(){return{}},methods:{copyCtrl:function(){var e=this.data.info;var r=$DS.getCtrlType(e.ds_id);var t=this.data.type+"_"+$DS.util.UUID();if(r!="row"&&!this.data.inRow){for(var o=0;o<VUECFG.sort.length;o++){if(VUECFG.sort[o]==e.ds_id){o++;VUECFG.sort.splice(o,0,t)}}addCopyCtrl(e,r,t)}else if(r!="row"&&this.data.inRow){var a=$DS.getCtrlById(this.data.inRow);if(a){var i=addCopyCtrl(e,r,t);var s=a.info.ds_rowarr;for(var n=0;n<s.length;n++){if(s[n].info.ds_id==e.ds_id){n++;s.splice(n,0,i.formObj)}}}}else if(r=="row"&&!this.data.inRow){for(var o=0;o<VUECFG.sort.length;o++){if(VUECFG.sort[o]==e.ds_id){o++;VUECFG.sort.splice(o,0,t)}}addCopyCtrl(e,r,t);if(e.ds_rowarr&&e.ds_rowarr.length>0){$DS.getCtrlById(t).info.ds_rowarr=[];copyRowChild(e.ds_rowarr,t)}}else if(r=="row"&&this.data.inRow){var a=$DS.getCtrlById(this.data.inRow);var i=addCopyCtrl(e,r,t);if(e.ds_rowarr){var l=$DS.util.clone(e.ds_rowarr);i.formObj.info.ds_rowarr=[];copyRowChild(l,t)}var s=a.info.ds_rowarr;for(var n=0;n<s.length;n++){if(s[n].info.ds_id==e.ds_id){n++;s.splice(n,0,i.formObj)}}}$DS.refPagePro();$DS.refForm();$DS.refPro();$DS.refSource()},delCtrl:deleteCtrl},template:util.getModelHtml("drag_comp")})}function addCopyCtrl(e,r,t){var o=$DS.util.clone(VUECFG.formObj[e.ds_id]);o.info.ds_id=t;o.info.ds_ctrlname=o.info.ds_ctrlname+"_copy";if(o.info.ds_datasource)o.info.ds_datasource="";if(o.info.ds_name)o.info.ds_name="";VUECFG.formObj[t]=o;VUECFG.ctrlId=t;VUECFG.ctrlType=r;var a=$DS.util.clone(VUECFG.proObj[e.ds_id]);for(var i=0;i<a.length;i++){if(a[i].info.ds_name=="ds_datasource"||a[i].info.ds_name=="ds_name"){var s=a[i].type.split("drag_")[1];a[i].info["ds_"+s]=""}if(a[i].info.ds_name=="ds_ctrlname"){a[i].info.ds_input=o.info.ds_ctrlname}}VUECFG.proObj[t]=a;if(e.ds_loading)VUECFG[`${e.ds_loading}Obj`][t]=t;return{formObj:o,proObj:a}}function copyRowChild(e,r){for(let d=0;d<e.length;d++){var t=e[d].info;var o=e[d].type;var a=o+"_"+$DS.util.UUID();var i=$DS.getCtrlById(r);var s=addCopyCtrl(t,o.split("_")[1],a);s.formObj.inRow=r;var n=[];if(o==="drag_row"&&s.formObj.info.ds_rowarr){n=$DS.util.clone(s.formObj.info.ds_rowarr);s.formObj.info.ds_rowarr=[]}var l=i.info.ds_rowarr;l.splice(l.length,0,s.formObj);if(n.length>0){copyRowChild(n,a)}}}function registerIcon(){Vue.component("drag_iconholder",{props:["icon"],methods:{chooseIcon:chooseIcon},template:util.getModelHtml("drag_iconholder")})}function initPage(e){var r=$page.showProperty();e.pageArr=r}function refearchPagePro(){$("#templetePagePro").click()}function dealPagePro(){var e=VUECFG.pageArr;this.pageArr=[];for(var r=0;r<e.length;r++){this.pageArr.push(e[r])}VUECFG.pageArr=this.pageArr;this.$forceUpdate()}function dragTabClick(e,r){}function getVueTempNode(e,r){if($($(e)[0].offsetParent).attr("draggable")=="false")return false;var t=$(e).attr("ctrltype");if(!r)r=t+"_"+Date.parse(new Date);var o={};try{o=window["$"+t.split("drag_")[1]].getConfig()}catch(e){util.exceptionRegister("$+"+t.split("drag_")[1]);o={}}o.ds_id=r;VUECFG.ctrlId=r;VUECFG.ctrlType=t.split("drag_")[1];var a={type:t,info:o};VUECFG.formObj[a.info.ds_id]=deepClone(a);VUECFG.normalObj[a.info.ds_id]=true;return a.info.ds_id}function getFormSort(e,r){var t=[];for(var o=0;o<e.length;o++){if(e[o].id==r)continue;t.push(e[o].id)}VUECFG.sort=t}function refearchFormArr(){$("#templeteModel").click()}function dealform(){var e=VUECFG.sort;this.formArr=[];for(var r=0;r<e.length;r++){var t=$DS.getCtrlById(e[r]);if(!t)continue;if(t.info.ds_rowarr){t=refearchRowArr(t)}this.formArr.push(t)}VUECFG.formArr=this.formArr;refearchFormPro();this.$forceUpdate()}function refearchRowArr(e){var r=$DS.util.clone(e.info.ds_rowarr);e.info.ds_rowarr=[];for(var t=0;t<r.length;t++){var o=r[t].info.ds_id;var a=$DS.getCtrlById(o);if(!a){console.error(`【${o}】控件不存在于容器【${e.info.ds_ctrlname}】中!`);continue}if(a.info.ds_rowarr){a=refearchRowArr(a)}e.info.ds_rowarr.push(a)}return e}function deleteCtrl(){var e=this.data.info.ds_ctrlname;this.$confirm(`此操作将永久删除【${e}】控件, 是否继续?`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{$DS.util.stopEvent(event);var e=this.data.info.ds_id;var r=$("#"+e)[0];if(!r){console.error("【ID:"+e+"】当前DOM节点找不到!");return}if($(r).attr("ctrltype")=="row"){$(r).find(".ds_ctrl").each(function(){deleteCtrlDatasourceRef(this.id);delete VUECFG.firstObj[this.id];delete VUECFG.normalObj[this.id];delete VUECFG.lazyObj[this.id];delete VUECFG.formObj[this.id];delete VUECFG.proObj[this.id]})}r.parentNode.removeChild(r);deleteCtrlDatasourceRef(e);VUECFG.proId=null;VUECFG.proType=null;VUECFG.ctrlType=null;VUECFG.ctrlId=$(r)[0].id;refearchFormPro();if(this.data.inRow){var t=this.data.inRow;getRowSort(t,e,true);delete VUECFG.formObj[VUECFG.ctrlId];delete VUECFG.proObj[VUECFG.ctrlId]}else{$("#templeteDel").click()}delete VUECFG.firstObj[VUECFG.ctrlId];delete VUECFG.normalObj[VUECFG.ctrlId];delete VUECFG.lazyObj[VUECFG.ctrlId];VUECFG.ctrlId=null;this.$message({type:"success",message:"删除成功!"})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})}function deleteCtrlDatasourceRef(e){var r=$DS.getCtrlById(e);if(r.info.ds_datasource){var t=VUECFG.groupObj[e];if(t){var o=$DS.getSourceById(t);if(o){delete o.sourceGroup[e];for(key in o.fieldMap){if(o.fieldMap[key]==e){delete o.fieldMap[key]}}}delete VUECFG.groupObj[e]}}}function deleteformCtrl(){var e=VUECFG.ctrlId;for(var r=0;r<this.formArr.length;r++){if(this.formArr[r].info.ds_id==e){this.formArr.splice(r,1)}}VUECFG.formArr=this.formArr;delete VUECFG.formObj[VUECFG.ctrlId];getFormSort($("#dropArea")[0].children)}function dealPro(){var e=VUECFG.proArr;this.proArr=[];for(var r=0;r<e.length;r++){this.proArr.push(e[r])}VUECFG.proArr=this.proArr;this.$forceUpdate()}function refearchFormPro(){if(VUECFG.viewStatu)return false;if(VUECFG.ctrlType){try{window["$"+VUECFG.ctrlType].showProperty()}catch(e){console.log(e);util.exceptionRegister("$"+VUECFG.ctrlType)}}else{VUECFG.proArr=[];delete VUECFG.proObj[VUECFG.ctrlId];$("#templetePro").click()}}function changeFormCtrl(e,r){var t=r.split("drag_")[1];if(t==VUECFG.ctrlType)return false;var o=VUECFG.ctrlId;VUECFG.ctrlType=t;var e={};try{e=window["$"+t].getConfig()}catch(r){util.exceptionRegister("$+"+t);e={}}e.ds_id=o;var a={type:r,info:e};VUECFG.formObj[o]=deepClone(a);getFormSort($("#dropArea")[0].children);refearchFormArr();if(t){try{window["$"+t].showProperty(true)}catch(e){console.log(e);util.exceptionRegister("$"+t)}}return false}function initAppForPage(){if(temporary.projectName){return temporary.projectName}if($("head").attr("view")&&getProjectName()!="/console_portal")return[];var e="/console_portal/sysconfig/getTreeData";var r={table:"dm_base_apps_view",id:"GUID",name:"'['||ITEMCODE||']'||ITEMNAME",pid:"SUPERGUID",order:"t.ITEMCODE",wherestr:"",rootText:"系统",dbSource:"",otherCols:",APPURL,PROJECTNAME,APPID,ITEMCODE"};var t=[];t=YCDCommon.Ajax.syncAjax(e,r);if(t){if(t.isError){alert(t.errMsg);return[]}else{t=t.result}}t=t?t:[];temporary.projectName=t;return t}function initApp(e){VUECFG.appArr=VUEAPP;if($DS.getPms("URL_APPID"))VUECFG.appId=$DS.getPms("URL_APPID");return VUEAPP}function changeSourceAppId(e){this.source.appId=e;$DS.refSource()}function getSourceTables(e,r){debugger;if(VUECFG.viewStatu||!e)return;var t=r?r:this.source.appId;if(!t)t=VUECFG.appId;if(!VUECFG.appObj[t]){var o=getProjectName();var a={appId:t,tableName:""};var i=YCDCommon.Ajax.syncAjax(o+"/console/table/getFKTableName",a);if(!i){console.error("重新查询数据源表和字段信息异常!");return false}if(i.isError){alert(i.errMsg);return}VUECFG.appObj[t]=i.result}if(this.source){this.source.tableInfo=[];this.source.tableInfo=VUECFG.appObj[t];$DS.refSource()}}function addDataSource(){if(!VUECFG.appId){alert("请先选择系统!");return false}var e=getSourceObj();VUECFG.sourceArr.push(e)}function getFildInfo(){var e=$DS.util.clone(this.source.fieldInfo);for(var r in e){if(e[r].hasOwnProperty("mergeSql")){delete e[r]["mergeSql"]}}var t=$DS.util.json(e);return t}function getComputedColums(){if(!this.source.columns||this.source.columns.length==0)return"";return JSON.stringify(this.source.columns)}function getSourceDataInfo(){var e=this.source.sourceId;var r=$DS.getSourceData(this.source);var t="";if(r)t=JSON.stringify(r);return t}function getTableFields(e){var r=this.source.appId?this.source.appId:VUECFG.appId;var t=$DS.selectFieldInfo(e,r,"查询字段信息异常");if(t.isError){alert(t.errMsg);return false}else{t=t.result}this.source.fieldInfo=formatFieldInfo(t);this.source.tableName=e;this.source.keyField="";this.source.fieldMap={}}function getSqlFields(e,r){debugger;var t="字段信息查询异常";var o=$DS.util.getProjectName();var a=o+"/sysconfig/frame/selectFactorsBySQL";var i={sql:e.sql?e.sql:""};var s=YCDCommon.Ajax.syncAjax(a,i);if(!s){alert("【"+t+"】系统错误!");console.error("【"+t+"】系统错误!")}if(s.isError){if(!noTip){alert("【"+t+"】"+s.errMsg)}console.error("【"+t+"】"+s.errMsg)}e.fieldInfo=formatFieldInfo(s.result);e.tableInfo=[];if(r)e.fieldMap={}}function clickTableFields(){if(this.source.sourceType=="sqlData"){getSqlFields(this.source)}var e=this.source.sourceId;window.top[e]=this.source;var r=getProjectName()+"/freeForm/manage/selectFactorsSource.jsp";showMyDialog("设置查找字段","90%","90%",r+"?key="+e,function(){})}function callBackSelectField(e,r){debugger;var t=getSourceById(r);var o=JSON.parse(e);t.columns=o;if(t.sourceType=="sqlData"){var a={TABLE_NAME:"",CODEFORMAT:"",FIELD_NAMECN:"",SUPERFIELD_NAME:"#",BDSHOWFIELDNAME:"",ISRESERVE:"",ISIDENTITY:"00",SHOW_NO:"0002",FK_FILTER:"",formulaDataStr:"",FORMULAID:"",FK_FIELDNAME:"",FK_TXTNAME:"",type:"",FK_FILTER2:"",FK_TABLENAME:"",CODEFORMATREMARK:"",BASETYPE:"",DESCRIPTION:"",FEILDFORMAT:"",ISPUB:"",SORTTYPE:"0",FIELD_NAME:"",DEFAULTVAL:"",REMARK:"",CODERULE:"",FIELD_SHOWDECLENGTH:0,ALLOWNULL:"1",ENDFLAG:"1",ALIGNTYPE:"left",APPID:"",BDFIELDNAME:"",ISKEYFIELD:"0",SHOW_CSS:"",ISSYS:"",ISSUM:"0",DELETECASCADE:"0",FIELD_LENGTH:100,FIELD_DECLENGTH:0,SHOW_COMPONENT:"input",FIELD_TYPE:"003",CNALIAS:"",SHOW_WIDTH:100,ISPRIMARYKEY:"0",ISBDCOL:"0",ISREFUSEMID:"0",TYPE:"input",MAXLENGTH:100};var i=t.fieldInfo?Object.keys(t.fieldInfo):[];if(i.length>0){var a=t.fieldInfo[i[0]];delete a["mergeSql"]}var s=[];for(var n=0;n<o.length;n++){var l=$DS.util.clone(a);l.FIELD_NAME=o[n].FIELD_NAME;l.FIELD_NAMECN=o[n].FIELD_NAMECN;l.SHOW_WIDTH=o[n].SHOW_WIDTH?o[n].SHOW_WIDTH:100;s.push(l)}t.fieldInfo=formatFieldInfo(s)}}function setKeyField(e){this.source.keyField=e}function deleteSource(){this.$confirm("此操作将永久删除该数据源, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{var e=this.source.sourceId;for(var r=0;r<VUECFG.sourceArr.length;r++){if(VUECFG.sourceArr[r].sourceId==e){VUECFG.sourceArr.splice(r,1)}}for(var t in VUECFG.groupObj){if(VUECFG.groupObj[t]==e){delete VUECFG.groupObj[t]}}this.$message({type:"success",message:"删除成功!"})}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})}function changeDatasourceOption(e,r){if(r){e.ds_options=getAllDatasource()}}function changeDataSourceForCtrl(e,r){debugger;var t=$DS.getSourceById(r);setGridDefaultRowKey(e,t);var o=e.ds_pid;var a=VUECFG.groupObj[o];if(a){var i=$DS.getSourceById(a);if(i){delete i.sourceGroup[o];for(key in i.fieldMap){if(i.fieldMap[key]==o){delete i.fieldMap[key]}}}}if(t){VUECFG.groupObj[o]=t.sourceId;t.sourceGroup[o]=o}else{delete VUECFG.groupObj[o]}if(t&&(t.sourceType=="levelData"||t.sourceType=="allData"||t.sourceType=="sqlData"))$DS.setSourceVal(t,o);if(!t){$DS.clearData($DS.getCtrlById(o))}}function setGridDefaultRowKey(e,r){if($DS.getCtrlType(e.ds_pid)!=="grid"){return}if(r&&r.keyField){$DS.setPro(e.ds_pid,"ds_row_key","input",r.keyField)}else if(!r||r&&!r.keyField){$DS.setPro(e.ds_pid,"ds_row_key","input","")}}function changeFieldOption(e,r){if(r){e.ds_options=getAllDatasourceField(e.ds_pid)}}function changeFieldNameForCtrl(e,r){var t=e.ds_pid;var o=$DS.getCtrlById(t).info;var a=VUECFG.groupObj[t];var i=$DS.getSourceById(a);if(i){for(key in i.fieldMap){if(i.fieldMap[key]==t){delete i.fieldMap[key]}}i.fieldMap[r]=t;if(o.ds_refdatasource){changeRefDataSourceForCtrl({ds_pid:t},o.ds_refdatasource)}else{buildRefOptions(t,i,r)}changeOtherPros(t,i,r)}else{if(o.ds_refdatasource)changeRefDataSourceForCtrl({ds_pid:t},o.ds_refdatasource)}}function buildRefOptions(e,r,t){var o=r.appId?r.appId:VUECFG.appId;var a=$DS.getOneField(r,t);if(!(a&&(a.FIELD_TYPE=="011"||a.FIELD_TYPE=="006")))return false;var i=$DS.getCtrlById(e);var s=[];var n="";var l="";var d=false;switch($DS.getCtrlType(e)){case"select":n="label";l="value";break;case"radio":n="text";l="value";if(a&&a.FIELD_TYPE=="011"){console.error("【"+a.FIELD_NAMECN+"】单选引用不能使用多选控件!");return false}break;case"checkbox":n="text";l="value";if(a&&a.FIELD_TYPE=="006"){console.error("【"+a.FIELD_NAMECN+"】多选引用不能使用单选控件!");return false}break;case"switch":n="NAME";l="ID";if(a&&a.FIELD_TYPE=="011"){console.error("【"+a.FIELD_NAMECN+"】单选引用不能使用多选控件!");return false}break;case"cascader":d=true;n="NAME";l="ID";break;case"poptree":d=true;n="NAME";l="ID";break}if(VUECFG.viewStatu){s=$DS.selectRefFiled(o,a,n,l,false,d);if(s.isError){alert(s.errMsg);return false}else{s=s.result}}if($DS.getCtrlType(e)!="switch"){i.info.ds_options=[];i.info.ds_options=s}}function changeRefDataSourceForCtrl(e,r){debugger;var t=e.ds_pid;var o=$DS.getCtrlById(e.ds_pid);var a=[];var i="";var s="";switch($DS.getCtrlType(t)){case"select":i="label";s="value";break;case"radio":i="text";s="value";break;case"checkbox":i="text";s="value";break;case"switch":i="NAME";s="ID";break;case"cascader":i="NAME";s="ID";break;case"poptree":i="NAME";s="ID";break}if(r){var n=$DS.getSourceById(r);if(VUECFG.viewStatu)a=$DS.getSourceData(n,false,o.info.ds_refdatasource_filter);if(s!="ID"&&i!="NAME"){a=formatterRefData(a,s,i)}}if($DS.getCtrlType(t)=="switch"){$DS.util.tryCatch(function({ctrl:e,refData:r}){e.info.ds_active_value=r[0].ID,e.info.ds_inactive_value=r[1].ID},null,"【"+o.info.ds_ctrlname+"】开关控件引用值设置失败!",{ctrl:o,refData:a})}else{o.info.ds_options=[];o.info.ds_options=a}}function formatterRefData(e,r,t){for(var o=0;o<e.length;o++){e[o][t]=e[o].NAME;e[o][r]=e[o].ID;if(e[o].children){e[o].children=formatterRefData(e[o].children,r,t)}}return e}function changeOtherPros(e,r,t){if(!t)return false;var o=$DS.getCtrlById(e);if(!o){delete VUECFG.proObj[e];delete VUECFG.groupObj[e];return false}var a=$DS.getOneField(r,t);if(!a)return false}function refearchFormSource(){$("#templeteSource").click()}function dealSource(){var e=VUECFG.sourceArr;this.sourceArr=[];for(var r=0;r<e.length;r++){this.sourceArr.push(e[r])}VUECFG.sourceArr=this.sourceArr;this.$forceUpdate()}function closeIcon(){this.iconHolder="y-hide"}function clickChooseIcon(e){vm._data.iconHolder=e.ds_pid+"|"+e.ds_name+"|input"}function chooseIcon(e){var r=vm._data.iconHolder;r=r.split("|");if(r){$DS.setPro(r[0],r[1],r[2],e);vm._data.iconHolder="y-hide"}}function commandExec(e){$DS.util.commonFunction(e)}function checkDuplication(e){var r=$DS.getCtrlById(e.ds_pid);$DS.getCtrl(r.info.ds_ctrlname)}function triggerRendering(e){debugger;var r=e.ds_pid;VUECFG.$refs[r].refdate++}function dataGroupCfg(e,r){debugger;var t=getAllDatasourceField(e.ds_pid);for(let e of t){e.name=e.label}$DS.openCfgTable([{field:"FIELD_NAME",title:"字段名",width:.5,codeType:"select",code:t},{field:"TYPE",title:"分组数据类型",width:.5,codeType:"select",code:[{name:"求和",value:"sum"},{name:"平均数",value:"avg"},{name:"最小值",value:"min"},{name:"最大值",value:"max"}]}],e.ds_input,function(r,t){r=JSON.parse(r);var o=$DS.getCtrlById(e.ds_pid);o.info.ds_group_cfg=r;e.ds_input=r;$DS.loadCtrl(o.info.ds_ctrlname)},"90%","80%","数据分组配置",{id:e.ds_pid})}function loadChartsCtrl(e,r){debugger;var t=$DS.getCtrlById(e.ds_pid);t.info.ds_group_fields=r;$DS.loadCtrl(t.info.ds_ctrlname)}